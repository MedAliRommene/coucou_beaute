{% extends 'adminpanel/base.html' %}
{% load static %}

{% block title %}Sélection du Centre - Avis{% endblock %}

{% block extra_css %}
<style>
    /* Design ultra-moderne avec glassmorphism */
    .glass {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border-radius: 20px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .glass:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        background: rgba(255, 255, 255, 0.15);
    }

    .kpi-glass {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(25px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        border-radius: 24px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .kpi-glass::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #F28BB2, #6CA9E0);
        transition: all 0.3s ease;
    }

    .kpi-glass:hover {
        transform: translateY(-6px) scale(1.03);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.12);
        background: rgba(255, 255, 255, 0.12);
    }

    .kpi-glass:hover::before {
        background: linear-gradient(90deg, #6CA9E0, #F28BB2);
    }

    .btn-glass {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #374151;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .btn-glass:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        color: #1f2937;
    }

    .btn-secondary-glass {
        background: rgba(107, 114, 128, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(107, 114, 128, 0.2);
        color: #6b7280;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(107, 114, 128, 0.1);
    }

    .btn-secondary-glass:hover {
        background: rgba(107, 114, 128, 0.2);
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 8px 25px rgba(107, 114, 128, 0.15);
        color: #374151;
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border-radius: 24px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .glass-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    }

    .gradient-text {
        background: linear-gradient(135deg, #F28BB2 0%, #6CA9E0 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .center-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 24px;
        padding: 28px;
        margin-bottom: 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .center-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #F28BB2, #6CA9E0);
        transition: all 0.3s ease;
    }

    .center-card:hover {
        transform: translateY(-8px) scale(1.03);
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        background: rgba(255, 255, 255, 0.15);
    }

    .center-card:hover::before {
        background: linear-gradient(90deg, #6CA9E0, #F28BB2);
    }

    .center-avatar {
        width: 72px;
        height: 72px;
        border-radius: 50%;
        background: linear-gradient(135deg, #F28BB2 0%, #6CA9E0 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 1.8rem;
        margin-bottom: 20px;
        box-shadow: 0 8px 25px rgba(242, 139, 178, 0.3);
        transition: all 0.3s ease;
    }

    .center-card:hover .center-avatar {
        transform: scale(1.1);
        box-shadow: 0 12px 35px rgba(242, 139, 178, 0.4);
    }

    .center-name {
        font-size: 1.4rem;
        font-weight: 700;
        color: #1f2937;
        margin-bottom: 10px;
    }

    .center-location {
        color: #6b7280;
        font-size: 1rem;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .center-stats {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        margin-bottom: 24px;
    }

    .stat-item {
        text-align: center;
        padding: 16px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.3s ease;
    }

    .stat-item:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
    }

    .stat-number {
        font-size: 1.8rem;
        font-weight: 800;
        background: linear-gradient(135deg, #F28BB2 0%, #6CA9E0 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 6px;
    }

    .stat-label {
        color: #6b7280;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .rating-display {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 20px;
    }

    .rating-stars {
        display: flex;
        gap: 3px;
    }

    .star {
        width: 18px;
        height: 18px;
        color: #fbbf24;
        transition: all 0.2s ease;
    }

    .star:hover {
        transform: scale(1.2);
    }

    .rating-number {
        font-weight: 700;
        color: #1f2937;
        font-size: 1.2rem;
    }

    .center-actions {
        display: flex;
        gap: 16px;
        margin-top: 24px;
    }

    .btn-center {
        background: linear-gradient(135deg, #F28BB2 0%, #6CA9E0 100%);
        color: white;
        border: none;
        padding: 14px 28px;
        border-radius: 20px;
        font-weight: 600;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 15px rgba(242, 139, 178, 0.4);
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        flex: 1;
        justify-content: center;
        font-size: 0.95rem;
    }

    .btn-center:hover {
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 8px 25px rgba(242, 139, 178, 0.6);
        color: white;
        text-decoration: none;
    }

    .btn-center.secondary {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        color: #374151;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .btn-center.secondary:hover {
        background: rgba(255, 255, 255, 0.2);
        transform: translateY(-3px) scale(1.05);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        color: #1f2937;
    }

    .status-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        position: absolute;
        top: 20px;
        right: 20px;
    }

    .status-verified {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }

    .status-pending {
        background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
    }

    .search-section {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 24px;
        padding: 32px;
        margin-bottom: 32px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
        transition: all 0.3s ease;
    }

    .search-section:hover {
        background: rgba(255, 255, 255, 0.15);
        transform: translateY(-2px);
    }

    .search-input {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 20px;
        padding: 18px 24px;
        font-size: 1.1rem;
        transition: all 0.3s ease;
        width: 100%;
        color: #374151;
    }

    .search-input:focus {
        outline: none;
        border-color: #F28BB2;
        box-shadow: 0 0 0 4px rgba(242, 139, 178, 0.1);
        background: rgba(255, 255, 255, 0.15);
    }

    .search-input::placeholder {
        color: #9ca3af;
    }

    .no-centers {
        text-align: center;
        padding: 100px 20px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        border-radius: 32px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    }

    .no-centers-icon {
        width: 100px;
        height: 100px;
        background: linear-gradient(135deg, #F28BB2 0%, #6CA9E0 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 32px;
        color: white;
        font-size: 2.5rem;
        box-shadow: 0 12px 35px rgba(242, 139, 178, 0.3);
        transition: all 0.3s ease;
    }

    .no-centers:hover .no-centers-icon {
        transform: scale(1.1);
        box-shadow: 0 15px 45px rgba(242, 139, 178, 0.4);
    }

    .animate-slide-up {
        animation: slideUp 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateY(30px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .animate-fade-in {
        animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
        }

        to {
            opacity: 1;
        }
    }

    .grid-cols-1 {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    @media (min-width: 768px) {
        .grid-cols-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
        }
    }

    @media (min-width: 1024px) {
        .grid-cols-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 24px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="p-6 space-y-6 animate-fade-in">
    <!-- Header Section -->
    <div class="glass p-8 animate-slide-up">
        <div class="flex items-center justify-between mb-6">
            <div>
                <!-- Titre avec icône dans un cercle gradient -->
                <div class="flex items-center gap-6 mb-6">
                    <div
                        class="w-20 h-20 rounded-full bg-gradient-to-br from-pink-400 via-purple-500 to-blue-500 flex items-center justify-center shadow-2xl">
                        <i data-lucide="building-2" class="w-10 h-10 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-5xl font-bold gradient-text mb-2">
                            Sélection du Centre
                        </h1>
                        <p class="text-gray-600 text-xl">Choisissez un centre pour gérer ses avis</p>
                    </div>
                </div>
            </div>

            <!-- Statistiques rapides -->
            <div class="text-right">
                <div class="kpi-glass p-6 text-center">
                    <div class="text-4xl font-bold text-gray-900 mb-2">{{ total_centers }}</div>
                    <div class="text-sm text-gray-600 font-medium uppercase tracking-wide">Centres</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Search Section -->
    <div class="search-section animate-slide-up">
        <div class="flex items-center gap-4 mb-8">
            <div
                class="w-12 h-12 rounded-full bg-gradient-to-br from-pink-400 to-blue-400 flex items-center justify-center">
                <i data-lucide="search" class="w-6 h-6 text-white"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-900">
                Rechercher un Centre
            </h3>
        </div>
        <input type="text" id="centerSearch" placeholder="Rechercher par nom, ville ou professionnelle..."
            class="search-input" onkeyup="filterCenters()">
    </div>

    <!-- Centers Grid -->
    <div class="space-y-6 animate-slide-up">
        {% if centers %}
        <div class="grid-cols-1 md:grid-cols-2 lg:grid-cols-3" id="centersGrid">
            {% for center in centers %}
            <div class="center-card"
                data-search="{{ center.business_name|lower }} {{ center.city|lower }} {{ center.professional.user.first_name|lower }} {{ center.professional.user.last_name|lower }}">
                <!-- Status Badge -->
                {% if center.is_verified %}
                <div class="status-badge status-verified">
                    <i data-lucide="check-circle" class="w-4 h-4 me-1"></i>
                    Vérifié
                </div>
                {% else %}
                <div class="status-badge status-pending">
                    <i data-lucide="clock" class="w-4 h-4 me-1"></i>
                    En attente
                </div>
                {% endif %}

                <!-- Center Avatar -->
                <div class="center-avatar">
                    {% if center.professional.extra.profile_photo %}
                    <img src="{{ center.professional.extra.profile_photo.url }}" alt="{{ center.business_name }}"
                        class="w-full h-full rounded-full object-cover">
                    {% else %}
                    {{ center.business_name|first|upper }}
                    {% endif %}
                </div>

                <!-- Center Info -->
                <div class="center-name">{{ center.business_name }}</div>
                <div class="center-location">
                    <i data-lucide="map-pin" class="w-4 h-4"></i>
                    {{ center.city }}
                </div>

                <!-- Rating -->
                <div class="rating-display">
                    <div class="rating-stars">
                        {% for i in "12345" %}
                        {% if forloop.counter <= center.avg_rating %} <i class="fas fa-star star"></i>
                            {% else %}
                            <i class="far fa-star star"></i>
                            {% endif %}
                            {% endfor %}
                    </div>
                    <div class="rating-number">{{ center.avg_rating }}/5</div>
                </div>

                <!-- Statistics -->
                <div class="center-stats">
                    <div class="stat-item">
                        <div class="stat-number">{{ center.total_reviews }}</div>
                        <div class="stat-label">Avis</div>
                    </div>
                   
                    <div class="stat-item">
                        <div class="stat-number">{{ center.avg_rating }}</div>
                        <div class="stat-label">Note</div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="center-actions">
                    <a href="{% url 'adminpanel:reviews_management' center.professional.id %}" class="btn-center">
                        <i data-lucide="star" class="w-5 h-5 me-2"></i>
                        Gérer les Avis
                    </a>
                    <a href="{% url 'adminpanel:pro_detail' center.professional.id %}" class="btn-center secondary">
                        <i data-lucide="eye" class="w-5 h-5 me-2"></i>
                        Voir Profil
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- No Centers -->
        <div class="no-centers">
            <div class="no-centers-icon">
                <i data-lucide="building-2" class="w-12 h-12"></i>
            </div>
            <h4 class="text-3xl font-bold text-gray-900 mb-4">Aucun centre trouvé</h4>
            <p class="text-gray-600 mb-8 text-lg">Il n'y a actuellement aucun centre professionnel dans le système.</p>
            <a href="{% url 'adminpanel:pros' %}" class="btn-center">
                <i data-lucide="plus" class="w-5 h-5 me-2"></i>
                Gérer les Professionnelles
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
    // Filter centers function
    function filterCenters() {
        const searchTerm = document.getElementById('centerSearch').value.toLowerCase();
        const centerCards = document.querySelectorAll('.center-card');

        centerCards.forEach(card => {
            const searchData = card.getAttribute('data-search');
            if (searchData.includes(searchTerm)) {
                card.style.display = 'block';
                card.style.animation = 'slideUp 0.3s ease';
            } else {
                card.style.display = 'none';
            }
        });
    }

    // Animation on scroll
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Observe all center cards
    document.querySelectorAll('.center-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'all 0.6s cubic-bezier(0.4, 0, 0.2, 1)';
        observer.observe(card);
    });

    // Initialize Lucide icons
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }

    // Initialize Lucide icons on page load
    document.addEventListener('DOMContentLoaded', function () {
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }
    });
</script>
{% endblock %}