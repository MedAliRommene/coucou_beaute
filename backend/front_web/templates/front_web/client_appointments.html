{% extends 'front_web/base_client.html' %}
{% load static %}
{% block title %}Mes rendez-vous - Coucou Beaut√©{% endblock %}

{% block extra_css %}
<style>
    .gradient-text {
        background: linear-gradient(135deg, #f5a3c7 0%, #c9b8ff 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* List item (replaces cards) */
    .appointment-item {
        background: linear-gradient(135deg, rgba(255, 255, 255, .95), rgba(255, 255, 255, .85));
        border: 1px solid rgba(255, 255, 255, .8);
        border-radius: 16px;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        box-shadow: 0 4px 20px rgba(16, 24, 40, .06);
        transition: transform .2s ease, box-shadow .2s ease, border-color .2s ease;
        position: relative;
        overflow: hidden;
    }

    .appointment-item::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        opacity: 0;
        transition: opacity .2s ease;
    }

    .appointment-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(16, 24, 40, .12);
        border-color: rgba(255, 255, 255, .9);
    }

    .appointment-item:hover::before {
        opacity: 1;
    }

    .appointment-item.confirmed::before {
        background: linear-gradient(180deg, #10b981, #059669);
    }

    .appointment-item.pending::before {
        background: linear-gradient(180deg, #f59e0b, #d97706);
    }

    .appointment-item.cancelled::before {
        background: linear-gradient(180deg, #ef4444, #dc2626);
    }

    .status-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        display: inline-block;
        margin-right: 8px;
    }

    .status-confirmed {
        background: #10b981;
    }

    .status-pending {
        background: #f59e0b;
    }

    .status-cancelled {
        background: #ef4444;
    }

    .filter-section {
        background: linear-gradient(135deg, rgba(255, 255, 255, .95), rgba(255, 255, 255, .85));
        border: 1px solid rgba(255, 255, 255, .8);
        border-radius: 20px;
        backdrop-filter: blur(16px);
        box-shadow: 0 8px 32px rgba(16, 24, 40, .08);
    }

    .filter-btn {
        background: rgba(255, 255, 255, .6);
        border: 1px solid rgba(255, 255, 255, .8);
        border-radius: 12px;
        padding: 8px 16px;
        font-weight: 600;
        transition: all .2s ease;
        backdrop-filter: blur(8px);
    }

    .filter-btn:hover {
        background: rgba(255, 255, 255, .85);
        transform: translateY(-1px);
    }

    .filter-btn.active {
        background: linear-gradient(135deg, #f5a3c7, #c9b8ff);
        color: #fff;
        border-color: transparent;
    }

    .date-picker {
        background: rgba(255, 255, 255, .85);
        border: 1px solid rgba(255, 255, 255, .95);
        border-radius: 12px;
        padding: 10px 14px;
        backdrop-filter: blur(8px);
        transition: all .2s ease;
    }

    .date-picker:focus {
        outline: none;
        border-color: #f5a3c7;
        box-shadow: 0 0 0 3px rgba(245, 163, 199, .12);
    }

    .appointment-time {
        background: linear-gradient(135deg, rgba(245, 163, 199, .1), rgba(201, 184, 255, .1));
        border-radius: 12px;
        padding: 8px 12px;
        font-weight: 700;
        color: #6b7280;
    }

    .appointment-price {
        background: linear-gradient(135deg, rgba(34, 197, 94, .1), rgba(22, 163, 74, .1));
        color: #059669;
        border-radius: 8px;
        padding: 4px 8px;
        font-weight: 700;
        font-size: 14px;
    }

    .professional-info {
        background: rgba(248, 250, 252, .85);
        border-radius: 12px;
        padding: 12px;
        border: 1px solid rgba(226, 232, 240, .6);
    }

    .appointment-list {
        max-height: 70vh;
        overflow-y: auto;
    }

    .appointment-list::-webkit-scrollbar {
        width: 6px;
    }

    .appointment-list::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, .05);
        border-radius: 3px;
    }

    .appointment-list::-webkit-scrollbar-thumb {
        background: rgba(245, 163, 199, .3);
        border-radius: 3px;
    }

    .appointment-list::-webkit-scrollbar-thumb:hover {
        background: rgba(245, 163, 199, .5);
    }

    .empty-state {
        text-align: center;
        padding: 80px 20px;
        background: linear-gradient(135deg, rgba(255, 255, 255, .8), rgba(255, 255, 255, .6));
        border-radius: 20px;
        backdrop-filter: blur(12px);
    }

    .fab-primary {
        position: fixed;
        right: 24px;
        bottom: 24px;
        z-index: 40;
        padding: 16px 20px;
        border-radius: 16px;
        box-shadow: 0 16px 40px rgba(240, 114, 182, .35);
        background: linear-gradient(135deg, #f5a3c7, #c9b8ff);
        color: #fff;
        font-weight: 700;
        display: inline-flex;
        align-items: center;
        gap: 10px;
        transition: transform .2s ease, box-shadow .2s ease;
    }

    .fab-primary:hover {
        transform: translateY(-3px) scale(1.02);
        box-shadow: 0 22px 50px rgba(154, 126, 255, .45);
    }

    .fab-pulse {
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% {
            box-shadow: 0 0 0 0 rgba(245, 163, 199, .5);
        }

        70% {
            box-shadow: 0 0 0 16px rgba(245, 163, 199, 0);
        }

        100% {
            box-shadow: 0 0 0 0 rgba(245, 163, 199, 0);
        }
    }

    /* ==========================
       RESPONSIVE MOBILE OPTIMIZATIONS
       ========================== */
    @media (max-width: 768px) {

        /* Mobile-friendly body */
        body {
            font-size: 16px !important;
            -webkit-text-size-adjust: 100%;
        }

        /* Hide blob animations on mobile */
        .animate-blob-1,
        .animate-blob-2 {
            display: none !important;
        }

        /* Container padding mobile */
        .max-w-7xl {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        .px-6 {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        .py-10 {
            padding-top: 1.5rem !important;
            padding-bottom: 1.5rem !important;
        }

        /* Header mobile */
        .flex.items-center.justify-between.mb-8 {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 1rem !important;
        }

        .flex.items-center.gap-4 {
            width: 100%;
        }

        .w-16.h-16 {
            width: 3rem !important;
            height: 3rem !important;
        }

        .w-16.h-16 [data-lucide] {
            width: 1.5rem !important;
            height: 1.5rem !important;
        }

        h1.text-4xl {
            font-size: 1.5rem !important;
        }

        .text-lg {
            font-size: 0.9375rem !important;
        }

        /* Back button mobile */
        .kpi-glass.px-6 {
            width: 100%;
            justify-content: center;
            padding: 0.875rem 1rem !important;
        }

        /* Filter section mobile */
        .filter-section {
            padding: 1rem !important;
        }

        .flex.flex-col.lg\\:flex-row {
            flex-direction: column !important;
            gap: 1rem !important;
        }

        /* Filter buttons mobile */
        .flex.flex-wrap.gap-3 {
            gap: 0.5rem !important;
            width: 100%;
        }

        .filter-btn {
            flex: 1;
            min-width: calc(50% - 0.25rem);
            font-size: 0.8125rem !important;
            padding: 0.75rem 0.5rem !important;
            justify-content: center;
        }

        .filter-btn [data-lucide] {
            width: 0.875rem !important;
            height: 0.875rem !important;
            margin-right: 0.25rem !important;
        }

        /* Date inputs mobile */
        .date-picker {
            font-size: 16px !important;
            padding: 0.875rem 0.75rem !important;
            width: 100%;
        }

        .flex.gap-3 {
            flex-direction: column !important;
            gap: 0.75rem !important;
            width: 100%;
        }

        /* Appointment items mobile */
        .appointment-item {
            padding: 1rem !important;
            border-radius: 1rem !important;
        }

        .appointment-item .flex.items-center.justify-between {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 1rem !important;
        }

        .appointment-item .flex.items-center.gap-4 {
            width: 100%;
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 0.75rem !important;
        }

        .appointment-item .flex.items-center.gap-3 {
            width: 100%;
        }

        .appointment-item .w-12.h-12 {
            width: 2.5rem !important;
            height: 2.5rem !important;
        }

        .appointment-item .w-12.h-12 [data-lucide] {
            width: 1.25rem !important;
            height: 1.25rem !important;
        }

        .appointment-item h3.text-lg {
            font-size: 1rem !important;
        }

        .appointment-item .text-xs {
            font-size: 0.6875rem !important;
        }

        /* Status badges mobile */
        .status-indicator {
            width: 8px !important;
            height: 8px !important;
        }

        /* Time/Price/Date mobile */
        .appointment-time,
        .appointment-price {
            font-size: 0.75rem !important;
            padding: 0.5rem 0.75rem !important;
        }

        .appointment-time [data-lucide],
        .appointment-price [data-lucide] {
            width: 0.875rem !important;
            height: 0.875rem !important;
        }

        .flex.items-center.gap-6 {
            flex-wrap: wrap !important;
            gap: 0.5rem !important;
        }

        /* Professional info mobile */
        .professional-info {
            width: 100% !important;
            margin-left: 0 !important;
            padding: 0.75rem !important;
        }

        .professional-info .text-xs {
            font-size: 0.6875rem !important;
        }

        /* Empty state mobile */
        .empty-state {
            padding: 2rem 1rem !important;
        }

        .empty-state .w-20.h-20 {
            width: 4rem !important;
            height: 4rem !important;
        }

        .empty-state h3.text-xl {
            font-size: 1.125rem !important;
        }

        /* FAB mobile */
        .fab-primary {
            right: 1rem !important;
            bottom: 1rem !important;
            padding: 0.875rem 1rem !important;
            font-size: 0.875rem !important;
        }

        .fab-primary [data-lucide] {
            width: 1rem !important;
            height: 1rem !important;
        }

        /* Appointment list scrolling */
        .appointment-list {
            max-height: none !important;
        }

        /* Spacing adjustments */
        .space-y-4>*+* {
            margin-top: 0.75rem !important;
        }

        .mb-8 {
            margin-bottom: 1.5rem !important;
        }
    }

    /* Small mobile (iPhone SE) */
    @media (max-width: 375px) {
        h1.text-4xl {
            font-size: 1.25rem !important;
        }

        .filter-btn {
            min-width: 100%;
            font-size: 0.75rem !important;
        }

        .appointment-item {
            padding: 0.75rem !important;
        }

        .fab-primary {
            padding: 0.75rem 0.875rem !important;
            font-size: 0.8125rem !important;
        }
    }

    /* Landscape mobile */
    @media (max-width: 768px) and (orientation: landscape) {
        .py-10 {
            padding-top: 1rem !important;
            padding-bottom: 1rem !important;
        }

        .appointment-list {
            max-height: 60vh !important;
            overflow-y: auto !important;
        }
    }

    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {

        .filter-btn,
        .appointment-item,
        .fab-primary {
            -webkit-tap-highlight-color: rgba(242, 139, 178, 0.2);
        }

        * {
            -webkit-overflow-scrolling: touch;
        }

        .filter-btn:active {
            opacity: 0.8;
            transform: scale(0.98);
        }
    }

    /* iOS Safari fixes */
    @supports (-webkit-touch-callout: none) {

        input,
        select {
            font-size: max(16px, 1rem) !important;
        }

        .min-h-screen {
            min-height: -webkit-fill-available;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-pink-50 via-white to-blue-50 relative">
    <!-- Animated background blobs -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute rounded-full mix-blend-multiply filter blur-2xl opacity-15 animate-blob-1 bg-pink-300"
            style="width: 400px; height: 400px; top: 15%; left: 10%;"></div>
        <div class="absolute rounded-full mix-blend-multiply filter blur-2xl opacity-15 animate-blob-2 bg-blue-300"
            style="width: 350px; height: 350px; bottom: 15%; right: 10%;"></div>
    </div>

    <div class="relative z-10 max-w-7xl mx-auto px-6 py-10">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-4">
                <div
                    class="w-16 h-16 rounded-2xl bg-gradient-to-br from-pink-400 to-blue-500 flex items-center justify-center shadow-xl">
                    <i data-lucide="calendar-heart" class="w-8 h-8 text-white"></i>
                </div>
                <div>
                    <h1 class="text-4xl font-bold gradient-text mb-2">Mes Rendez-vous</h1>
                    <p class="text-gray-600 text-lg">G√©rez et suivez vos r√©servations</p>
                </div>
            </div>
            <a href="{% url 'front_web:client_dashboard' %}"
                class="kpi-glass px-6 py-3 rounded-xl font-semibold text-gray-700 hover:text-pink-600 transition-colors flex items-center gap-2">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                Retour
            </a>
        </div>

        <!-- Filters -->
        <div class="filter-section p-6 mb-8">
            <div class="flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between">
                <div class="flex flex-wrap gap-3">
                    <button class="filter-btn active" data-filter="all">
                        <i data-lucide="list" class="w-4 h-4 mr-2"></i>
                        Tous ({{ total_count }})
                    </button>
                    {% if confirmed_count %}
                    <button class="filter-btn" data-filter="confirmed">
                        <i data-lucide="check-circle" class="w-4 h-4 mr-2"></i>
                        Confirm√©s ({{ confirmed_count }})
                    </button>
                    {% endif %}
                    {% if pending_count %}
                    <button class="filter-btn" data-filter="pending">
                        <i data-lucide="clock" class="w-4 h-4 mr-2"></i>
                        En attente ({{ pending_count }})
                    </button>
                    {% endif %}
                    {% if cancelled_count %}
                    <button class="filter-btn" data-filter="cancelled">
                        <i data-lucide="x-circle" class="w-4 h-4 mr-2"></i>
                        Annul√©s ({{ cancelled_count }})
                    </button>
                    {% endif %}
                    <button class="filter-btn" id="quickToday">
                        <i data-lucide="sun" class="w-4 h-4 mr-2"></i> Aujourd'hui
                    </button>
                    <button class="filter-btn" id="quickUpcoming">
                        <i data-lucide="calendar" class="w-4 h-4 mr-2"></i> √Ä venir
                    </button>
                </div>
                <div class="flex gap-3">
                    <input type="date" id="dateFrom" class="date-picker" placeholder="Date de d√©but">
                    <input type="date" id="dateTo" class="date-picker" placeholder="Date de fin">
                    <button id="resetFilters" class="filter-btn">
                        <i data-lucide="refresh-cw" class="w-4 h-4 mr-2"></i>
                        R√©initialiser
                    </button>
                </div>
            </div>
        </div>

        {% if confirmed or pending or cancelled %}
        <!-- Unified list -->
        <div class="appointment-list space-y-4">
            {% for a in confirmed %}
            <div class="appointment-item confirmed p-6" data-status="confirmed" data-date="{{ a.start|date:'Y-m-d' }}">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4 flex-1">
                        <div class="flex items-center gap-3">
                            <span class="status-indicator status-confirmed"></span>
                            <div
                                class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center">
                                <i data-lucide="sparkles" class="w-6 h-6 text-green-600"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 class="text-lg font-bold text-gray-900">{{ a.service_name }}</h3>
                                <span
                                    class="px-3 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-full">CONFIRM√â</span>
                            </div>
                            <p class="text-gray-600 mb-3">{{ a.center_name }}</p>
                            <div class="flex items-center gap-6 text-sm">
                                <div class="appointment-time"><i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
                                    {{ a.start|date:"d/m/Y" }}</div>
                                <div class="appointment-time"><i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                                    {{ a.start|date:"H:i" }} </div>
                                <div class="appointment-price"><i data-lucide="banknote" class="w-4 h-4 mr-1"></i>
                                    {{a.price }} DT</div>
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 ml-4">
                        <a href="{% url 'front_web:client_calendar' %}" class="filter-btn">
                            <i data-lucide="calendar-plus" class="w-4 h-4 mr-1"></i> Calendrier
                        </a>
                    </div>
                    {% if a.professional_email or a.professional_phone or a.professional_address or a.business_name or   a.map_url %}
                  



                    <div class="professional-info ml-4">
                        <div class="flex items-center gap-2 mb-2"><i data-lucide="user-check"
                                class="w-4 h-4 text-green-500"></i><span
                                class="text-sm font-medium text-gray-700">Professionnel</span></div>
                        <div class="space-y-1 text-xs text-gray-600">
                            {% if a.professional_phone %}<div class="flex items-center gap-2"><i data-lucide="phone"
                                    class="w-3 h-3"></i>{{ a.professional_phone }}</div>{% endif %}
                            {% if a.professional_email %}<div class="flex items-center gap-2"><i data-lucide="mail"
                                    class="w-3 h-3"></i>{{ a.professional_email }}</div>{% endif %}
                            {% if a.professional_address %}<div class="flex items-center gap-2"><i data-lucide="map-pin"
                                    class="w-3 h-3"></i>{{ a.professional_address }}</div>{% endif %}
                            {% if a.map_url %}<div class="flex items-center gap-2"><i data-lucide="map"
                                    class="w-3 h-3"></i><a href="{{ a.map_url }}" target="_blank" rel="noopener"
                                    class="text-blue-600 hover:underline">Voir sur Google Maps</a></div>{% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}

            {% for a in pending %}
            <div class="appointment-item pending p-6" data-status="pending" data-date="{{ a.start|date:'Y-m-d' }}">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4 flex-1">
                        <div class="flex items-center gap-3">
                            <span class="status-indicator status-pending"></span>
                            <div
                                class="w-12 h-12 rounded-xl bg-gradient-to-br from-yellow-100 to-yellow-200 flex items-center justify-center">
                                <i data-lucide="clock" class="w-6 h-6 text-yellow-600"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 class="text-lg font-bold text-gray-900">{{ a.service_name }}</h3>
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-700 text-xs font-bold rounded-full">EN
                                    ATTENTE</span>
                            </div>
                            <p class="text-gray-600 mb-3">{{ a.center_name }}</p>
                            <div class="flex items-center gap-6 text-sm">
                                <div class="appointment-time"><i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
                                    {{a.start|date:"d/m/Y" }}</div>
                                <div class="appointment-time"><i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                                    {{ a.start|date:"H:i" }} </div>
                                <div class="appointment-price"><i data-lucide="banknote" class="w-4 h-4 mr-1"></i>
                                    {{a.price }} DT</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}

            {% for a in cancelled %}
            <div class="appointment-item cancelled p-6" data-status="cancelled" data-date="{{ a.start|date:'Y-m-d' }}">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4 flex-1">
                        <div class="flex items-center gap-3">
                            <span class="status-indicator status-cancelled"></span>
                            <div
                                class="w-12 h-12 rounded-xl bg-gradient-to-br from-red-100 to-red-200 flex items-center justify-center">
                                <i data-lucide="x-circle" class="w-6 h-6 text-red-600"></i>
                            </div>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-2">
                                <h3 class="text-lg font-bold text-gray-900">{{ a.service_name }}</h3>
                                <span
                                    class="px-3 py-1 bg-red-100 text-red-700 text-xs font-bold rounded-full">ANNUL√â</span>
                            </div>
                            <p class="text-gray-600 mb-3">{{ a.center_name }}</p>
                            <div class="flex items-center gap-6 text-sm">
                                <div class="appointment-time"><i data-lucide="calendar" class="w-4 h-4 mr-1"></i>
                                    {{a.start|date:"d/m/Y" }}</div>
                                <div class="appointment-time"><i data-lucide="clock" class="w-4 h-4 mr-1"></i>
                                    {{ a.start|date:"H:i" }} - {{ a.end|date:"H:i" }}</div>
                                <div class="appointment-price"><i data-lucide="banknote" class="w-4 h-4 mr-1"></i>
                                    {{ a.price }} DT</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div
                class="w-20 h-20 rounded-full bg-gradient-to-br from-pink-100 to-blue-100 flex items-center justify-center mx-auto mb-6">
                <i data-lucide="calendar" class="w-10 h-10 text-gray-400"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-700 mb-2">Aucun rendez-vous</h3>
            <p class="text-gray-500 mb-6">Vous n'avez pas encore de rendez-vous programm√©s.</p>

        </div>
        {% endif %}
    </div>

    <!-- Floating Action Button -->

</div>

<script>
    // Client-side filters
    document.addEventListener('DOMContentLoaded', function () {
        const filterBtns = document.querySelectorAll('.filter-btn');
        const items = document.querySelectorAll('.appointment-item');
        const dateFrom = document.getElementById('dateFrom');
        const dateTo = document.getElementById('dateTo');
        const resetBtn = document.getElementById('resetFilters');
        const quickToday = document.getElementById('quickToday');
        const quickUpcoming = document.getElementById('quickUpcoming');

        function applyFilters() {
            const active = document.querySelector('.filter-btn.active')?.dataset.filter || 'all';
            const from = dateFrom.value ? new Date(dateFrom.value) : null;
            const to = dateTo.value ? new Date(dateTo.value) : null;

            items.forEach(it => {
                let show = true;
                if (active !== 'all' && it.dataset.status !== active) show = false;
                if (show && (from || to)) {
                    const d = new Date(it.dataset.date);
                    if (from && d < from) show = false;
                    if (to && d > to) show = false;
                }
                it.style.display = show ? 'block' : 'none';
            });
        }

        filterBtns.forEach(b => b.addEventListener('click', function () {
            filterBtns.forEach(x => x.classList.remove('active'));
            this.classList.add('active');
            applyFilters();
        }));

        dateFrom?.addEventListener('change', applyFilters);
        dateTo?.addEventListener('change', applyFilters);
        resetBtn?.addEventListener('click', function () {
            filterBtns.forEach(x => x.classList.remove('active'));
            document.querySelector('[data-filter="all"]').classList.add('active');
            if (dateFrom) dateFrom.value = '';
            if (dateTo) dateTo.value = '';
            applyFilters();
        });

        quickToday?.addEventListener('click', function () {
            const t = new Date();
            const yyyy = t.getFullYear();
            const mm = String(t.getMonth() + 1).padStart(2, '0');
            const dd = String(t.getDate()).padStart(2, '0');
            const todayStr = `${yyyy}-${mm}-${dd}`;
            dateFrom.value = todayStr;
            dateTo.value = todayStr;
            applyFilters();
        });

        quickUpcoming?.addEventListener('click', function () {
            const t = new Date();
            const yyyy = t.getFullYear();
            const mm = String(t.getMonth() + 1).padStart(2, '0');
            const dd = String(t.getDate()).padStart(2, '0');
            const todayStr = `${yyyy}-${mm}-${dd}`;
            dateFrom.value = todayStr;
            dateTo.value = '';
            applyFilters();
        });
    });
</script>
{% endblock %}