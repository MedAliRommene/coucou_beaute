{% extends 'front_web/base_client.html' %}
{% load static %}
{% block title %}Mes rendez-vous - Coucou Beaut√©{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap');

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    /* ==========================
       COLOR PALETTE - PASTEL MODERN
       ========================== */
    :root {
        --rose-pale: #FFE5F1;
        --rose-poudre: #F8BBD0;
        --lavande: #E8D5FF;
        --bleu-clair: #D6E9FF;
        --blanc-pur: #FFFFFF;
        --gris-doux: #F8F9FA;
        --texte-principal: #2D3748;
        --texte-secondaire: #718096;
        --ombre-douce: rgba(0, 0, 0, 0.04);
        --ombre-moyenne: rgba(0, 0, 0, 0.08);
    }

    /* ==========================
       BACKGROUND & LAYOUT
       ========================== */
    .appointments-page {
        min-height: 100vh;
        background: linear-gradient(135deg, #FFF0F8 0%, #F0F4FF 50%, #FFF8F0 100%);
        position: relative;
        overflow-x: hidden;
    }

    .appointments-page::before {
        content: '';
        position: fixed;
        top: -50%;
        right: -20%;
        width: 800px;
        height: 800px;
        background: radial-gradient(circle, rgba(255, 182, 193, 0.15) 0%, transparent 70%);
        border-radius: 50%;
        animation: float 20s ease-in-out infinite;
        pointer-events: none;
    }

    .appointments-page::after {
        content: '';
        position: fixed;
        bottom: -30%;
        left: -10%;
        width: 600px;
        height: 600px;
        background: radial-gradient(circle, rgba(200, 181, 255, 0.15) 0%, transparent 70%);
        border-radius: 50%;
        animation: float 25s ease-in-out infinite reverse;
        pointer-events: none;
    }

    @keyframes float {

        0%,
        100% {
            transform: translate(0, 0) rotate(0deg);
        }

        33% {
            transform: translate(30px, -30px) rotate(120deg);
        }

        66% {
            transform: translate(-20px, 20px) rotate(240deg);
        }
    }

    /* ==========================
       HEADER SECTION
       ========================== */
    .page-header {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 28px;
        padding: 2rem 2.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 8px 32px var(--ombre-douce);
        border: 1px solid rgba(255, 255, 255, 0.8);
        animation: fadeInDown 0.6s ease-out;
    }

    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .header-icon {
        width: 64px;
        height: 64px;
        border-radius: 20px;
        background: linear-gradient(135deg, #FFB6D9 0%, #C9B8FF 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 24px rgba(255, 182, 217, 0.3);
        animation: iconPulse 2s ease-in-out infinite;
    }

    @keyframes iconPulse {

        0%,
        100% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.05);
        }
    }

    .page-title {
        font-family: 'Poppins', sans-serif;
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(135deg, #FF8DC7 0%, #B794F6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 0;
        line-height: 1.2;
    }

    .page-subtitle {
        color: var(--texte-secondaire);
        font-size: 1.1rem;
        font-weight: 400;
        margin-top: 0.5rem;
    }

    /* ==========================
       SEARCH & FILTERS SECTION
       ========================== */
    .filters-section {
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.85) 100%);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 24px;
        padding: 1.5rem 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 8px 32px var(--ombre-douce);
        border: 1px solid rgba(255, 255, 255, 0.8);
        animation: fadeInUp 0.6s ease-out 0.2s both;
    }

    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .search-bar {
        position: relative;
        margin-bottom: 1.5rem;
    }

    .search-input {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        border-radius: 16px;
        border: 2px solid rgba(255, 182, 217, 0.2);
        background: rgba(255, 255, 255, 0.9);
        font-size: 1rem;
        transition: all 0.3s ease;
        font-family: 'Inter', sans-serif;
    }

    .search-input:focus {
        outline: none;
        border-color: #FFB6D9;
        box-shadow: 0 0 0 4px rgba(255, 182, 217, 0.15);
        background: rgba(255, 255, 255, 1);
    }

    .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--texte-secondaire);
        width: 20px;
        height: 20px;
    }

    .filter-tabs {
        display: flex;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .filter-tab {
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        border: 2px solid transparent;
        background: rgba(255, 255, 255, 0.7);
        color: var(--texte-principal);
        font-weight: 500;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-family: 'Inter', sans-serif;
    }

    .filter-tab:hover {
        background: rgba(255, 255, 255, 0.9);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px var(--ombre-douce);
    }

    .filter-tab.active {
        background: linear-gradient(135deg, #FFB6D9 0%, #C9B8FF 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 4px 16px rgba(255, 182, 217, 0.3);
    }

    .filter-tab .badge {
        background: rgba(255, 255, 255, 0.3);
        padding: 0.125rem 0.5rem;
        border-radius: 8px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .date-range {
        display: flex;
        gap: 1rem;
        align-items: center;
    }

    .date-input {
        padding: 0.75rem 1rem;
        border-radius: 12px;
        border: 2px solid rgba(255, 182, 217, 0.2);
        background: rgba(255, 255, 255, 0.9);
        font-size: 0.9rem;
        transition: all 0.3s ease;
        font-family: 'Inter', sans-serif;
    }

    .date-input:focus {
        outline: none;
        border-color: #FFB6D9;
        box-shadow: 0 0 0 4px rgba(255, 182, 217, 0.15);
    }

    .reset-btn {
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        border: 2px solid rgba(255, 182, 217, 0.3);
        background: rgba(255, 255, 255, 0.9);
        color: var(--texte-principal);
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-family: 'Inter', sans-serif;
    }

    .reset-btn:hover {
        background: rgba(255, 255, 255, 1);
        border-color: #FFB6D9;
        transform: translateY(-2px);
    }

    /* ==========================
       APPOINTMENT CARDS - MODERN DESIGN
       ========================== */
    .appointments-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
    }

    @media (min-width: 1024px) {
        .appointments-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }

    @media (min-width: 768px) and (max-width: 1023px) {
        .appointments-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .appointment-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 1.75rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.9);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        animation: cardSlideIn 0.6s ease-out both;
    }

    @keyframes cardSlideIn {
        from {
            opacity: 0;
            transform: translateY(30px) scale(0.95);
        }

        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }

    .appointment-card:nth-child(1) {
        animation-delay: 0.05s;
    }

    .appointment-card:nth-child(2) {
        animation-delay: 0.1s;
    }

    .appointment-card:nth-child(3) {
        animation-delay: 0.15s;
    }

    .appointment-card:nth-child(4) {
        animation-delay: 0.2s;
    }

    .appointment-card:nth-child(5) {
        animation-delay: 0.25s;
    }

    .appointment-card:nth-child(6) {
        animation-delay: 0.3s;
    }

    .appointment-card:nth-child(n+7) {
        animation-delay: 0.35s;
    }

    .appointment-card::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        border-radius: 20px 0 0 20px;
        transition: width 0.3s ease;
    }

    .appointment-card.confirmed::before {
        background: linear-gradient(180deg, #34d399, #14b8a6);
    }

    .appointment-card.pending::before {
        background: linear-gradient(180deg, #fbbf24, #facc15);
    }

    .appointment-card.cancelled::before {
        background: linear-gradient(180deg, #fb7185, #f87171);
    }

    .appointment-card:hover {
        transform: translateY(-6px) scale(1.02);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.1);
        background: rgba(255, 255, 255, 0.85);
    }

    .appointment-card:hover::before {
        width: 6px;
    }

    .card-header {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        margin-bottom: 1.25rem;
    }

    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .status-badge.confirmed {
        background: linear-gradient(135deg, #34d399, #14b8a6);
        color: white;
        box-shadow: 0 2px 8px rgba(52, 211, 153, 0.3);
    }

    .status-badge.pending {
        background: linear-gradient(135deg, #fbbf24, #facc15);
        color: white;
        box-shadow: 0 2px 8px rgba(251, 191, 36, 0.3);
    }

    .status-badge.cancelled {
        background: linear-gradient(135deg, #fb7185, #f87171);
        color: white;
        box-shadow: 0 2px 8px rgba(251, 113, 133, 0.3);
    }

    .service-name {
        font-family: 'Poppins', sans-serif;
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--texte-principal);
        margin: 0 0 0.5rem 0;
    }

    .center-name {
        color: var(--texte-secondaire);
        font-size: 0.95rem;
        margin-bottom: 1.25rem;
    }

    .card-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.75rem;
        margin-bottom: 1.25rem;
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: linear-gradient(135deg, rgba(255, 182, 217, 0.1), rgba(201, 184, 255, 0.1));
        border-radius: 10px;
        font-size: 0.875rem;
        color: var(--texte-principal);
        font-weight: 500;
    }

    .meta-item.price {
        background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.1));
        color: #059669;
        font-weight: 700;
    }

    .card-actions {
        display: flex;
        gap: 0.75rem;
        margin-top: 1.25rem;
        padding-top: 1.25rem;
        border-top: 1px solid rgba(0, 0, 0, 0.06);
    }

    .action-btn {
        flex: 1;
        padding: 0.75rem 1rem;
        border-radius: 12px;
        border: 2px solid transparent;
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-family: 'Inter', sans-serif;
    }

    .action-btn.primary {
        background: linear-gradient(135deg, #FFB6D9 0%, #C9B8FF 100%);
        color: white;
        border-color: transparent;
    }

    .action-btn.primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 182, 217, 0.4);
    }

    .action-btn.secondary {
        background: rgba(255, 255, 255, 0.9);
        border-color: rgba(255, 182, 217, 0.3);
        color: var(--texte-principal);
    }

    .action-btn.secondary:hover {
        background: rgba(255, 255, 255, 1);
        border-color: #FFB6D9;
    }

    /* ==========================
       DETAIL DRAWER (SIDE PANEL)
       ========================== */
    .drawer-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        backdrop-filter: blur(4px);
        -webkit-backdrop-filter: blur(4px);
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .drawer-overlay.active {
        opacity: 1;
        visibility: visible;
    }

    .detail-drawer {
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        width: 100%;
        max-width: 520px;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(30px);
        -webkit-backdrop-filter: blur(30px);
        box-shadow: -4px 0 40px rgba(0, 0, 0, 0.1);
        border-left: 1px solid rgba(255, 255, 255, 0.9);
        z-index: 1001;
        transform: translateX(100%);
        transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
    }

    .detail-drawer.active {
        transform: translateX(0);
    }

    .drawer-header {
        padding: 2rem 2rem 1.5rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        position: sticky;
        top: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        z-index: 10;
    }

    .drawer-close-btn {
        position: absolute;
        top: 1.5rem;
        right: 1.5rem;
        width: 40px;
        height: 40px;
        border-radius: 12px;
        border: none;
        background: rgba(0, 0, 0, 0.05);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .drawer-close-btn:hover {
        background: rgba(0, 0, 0, 0.1);
        transform: rotate(90deg);
    }

    .drawer-content {
        padding: 2rem;
        flex: 1;
    }

    .detail-section {
        margin-bottom: 2rem;
    }

    .detail-section-title {
        font-family: 'Poppins', sans-serif;
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--texte-principal);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .professional-info {
        background: linear-gradient(135deg, rgba(248, 250, 252, 0.8), rgba(241, 245, 249, 0.8));
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid rgba(0, 0, 0, 0.06);
    }

    .info-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 0;
        color: var(--texte-secondaire);
        font-size: 0.9rem;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    }

    .info-item:last-child {
        border-bottom: none;
    }

    .info-item a {
        color: #2563EB;
        text-decoration: none;
    }

    .info-item a:hover {
        text-decoration: underline;
    }

    /* ==========================
       EMPTY STATE
       ========================== */
    .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(255, 255, 255, 0.85));
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 28px;
        box-shadow: 0 8px 32px var(--ombre-douce);
        border: 1px solid rgba(255, 255, 255, 0.8);
        animation: fadeInUp 0.6s ease-out;
    }

    .empty-icon {
        width: 120px;
        height: 120px;
        margin: 0 auto 1.5rem;
        background: linear-gradient(135deg, #FFB6D9, #C9B8FF);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 8px 24px rgba(255, 182, 217, 0.3);
    }

    .empty-title {
        font-family: 'Poppins', sans-serif;
        font-size: 1.75rem;
        font-weight: 600;
        color: var(--texte-principal);
        margin-bottom: 0.75rem;
    }

    .empty-message {
        color: var(--texte-secondaire);
        font-size: 1.1rem;
        margin-bottom: 2rem;
    }

    /* ==========================
       PAGINATION
       ========================== */
    .pagination-container {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 0.5rem;
        margin-top: 2rem;
        padding: 1.5rem;
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.9);
    }

    .pagination-btn {
        min-width: 40px;
        height: 40px;
        padding: 0.5rem 1rem;
        border-radius: 12px;
        border: 2px solid rgba(255, 182, 217, 0.2);
        background: rgba(255, 255, 255, 0.9);
        color: var(--texte-principal);
        font-weight: 500;
        font-size: 0.875rem;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        font-family: 'Inter', sans-serif;
    }

    .pagination-btn:hover:not(:disabled) {
        background: rgba(255, 255, 255, 1);
        border-color: #FFB6D9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(255, 182, 217, 0.2);
    }

    .pagination-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    .pagination-btn.active {
        background: linear-gradient(135deg, #FFB6D9 0%, #C9B8FF 100%);
        color: white;
        border-color: transparent;
        box-shadow: 0 4px 12px rgba(255, 182, 217, 0.3);
    }

    .pagination-info {
        color: var(--texte-secondaire);
        font-size: 0.875rem;
        margin: 0 1rem;
        white-space: nowrap;
    }

    /* ==========================
       FLOATING ACTION BUTTON
       ========================== */
    .fab {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 64px;
        height: 64px;
        border-radius: 20px;
        background: linear-gradient(135deg, #FFB6D9 0%, #C9B8FF 100%);
        color: white;
        border: none;
        cursor: pointer;
        box-shadow: 0 8px 24px rgba(255, 182, 217, 0.4);
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 100;
        animation: fabPulse 2s ease-in-out infinite;
        text-decoration: none;
    }

    @keyframes fabPulse {

        0%,
        100% {
            box-shadow: 0 8px 24px rgba(255, 182, 217, 0.4);
        }

        50% {
            box-shadow: 0 8px 32px rgba(255, 182, 217, 0.6), 0 0 0 8px rgba(255, 182, 217, 0.1);
        }
    }

    .fab:hover {
        transform: translateY(-4px) scale(1.1);
        box-shadow: 0 12px 32px rgba(255, 182, 217, 0.5);
    }

    .fab:active {
        transform: translateY(-2px) scale(1.05);
    }

    /* ==========================
       LOADING STATE
       ========================== */
    .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(8px);
        z-index: 2000;
        display: none;
        align-items: center;
        justify-content: center;
    }

    .loading-overlay.active {
        display: flex;
    }

    .spinner {
        width: 48px;
        height: 48px;
        border: 4px solid rgba(255, 182, 217, 0.2);
        border-top-color: #FFB6D9;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    /* ==========================
       RESPONSIVE MOBILE
       ========================== */
    @media (max-width: 768px) {
        .page-header {
            padding: 1.5rem;
            border-radius: 20px;
        }

        .page-title {
            font-size: 1.75rem;
        }

        .page-subtitle {
            font-size: 1rem;
        }

        .header-icon {
            width: 48px;
            height: 48px;
        }

        .filters-section {
            padding: 1.25rem;
            border-radius: 20px;
        }

        .filter-tabs {
            gap: 0.5rem;
        }

        .filter-tab {
            padding: 0.625rem 1rem;
            font-size: 0.8rem;
        }

        .date-range {
            flex-direction: column;
            gap: 0.75rem;
        }

        .date-input,
        .reset-btn {
            width: 100%;
        }

        .appointments-grid {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .appointment-card {
            padding: 1.5rem;
            border-radius: 18px;
        }

        .service-name {
            font-size: 1.25rem;
        }

        .detail-drawer {
            max-width: 100%;
        }

        .drawer-header {
            padding: 1.5rem 1.5rem 1rem;
        }

        .drawer-content {
            padding: 1.5rem;
        }

        .fab {
            width: 56px;
            height: 56px;
            bottom: 1.5rem;
            right: 1.5rem;
        }

        .empty-state {
            padding: 2.5rem 1.5rem;
        }

        .empty-icon {
            width: 80px;
            height: 80px;
        }

        .empty-title {
            font-size: 1.5rem;
        }
    }

    @media (max-width: 480px) {
        .page-title {
            font-size: 1.5rem;
        }

        .filter-tab {
            flex: 1;
            min-width: calc(50% - 0.25rem);
            justify-content: center;
        }

        .card-meta {
            flex-direction: column;
        }

        .meta-item {
            width: 100%;
        }

        .card-actions {
            flex-direction: column;
        }

        .pagination-container {
            flex-wrap: wrap;
            padding: 1rem;
        }

        .pagination-info {
            font-size: 0.75rem;
            margin: 0 0.5rem;
            width: 100%;
            text-align: center;
            order: 3;
        }

        .pagination-btn {
            min-width: 36px;
            height: 36px;
            padding: 0.375rem 0.75rem;
            font-size: 0.8rem;
        }

        #paginationNumbers {
            display: none;
        }
    }

    /* ==========================
       ACCESSIBILITY & ANIMATIONS
       ========================== */
    @media (prefers-reduced-motion: reduce) {

        *,
        *::before,
        *::after {
            animation-duration: 0.01ms !important;
            animation-iteration-count: 1 !important;
            transition-duration: 0.01ms !important;
        }
    }

    /* Smooth scrolling */
    html {
        scroll-behavior: smooth;
    }

    /* Focus styles */
    button:focus-visible,
    input:focus-visible,
    .filter-tab:focus-visible {
        outline: 2px solid #FFB6D9;
        outline-offset: 2px;
    }
</style>
{% endblock %}

{% block content %}
<div class="appointments-page">
    <div class="relative z-10 max-w-7xl mx-auto px-4 sm:px-6 py-8">
        <!-- Page Header -->
        <div class="page-header">
            <div class="flex items-center justify-between mb-4">
                <div class="flex items-center gap-4">
                    <div class="header-icon">
                        <i data-lucide="calendar-heart" class="w-8 h-8 text-white"></i>
                    </div>
                    <div>
                        <h1 class="page-title">Mes Rendez-vous</h1>
                        <p class="page-subtitle">G√©rez vos r√©servations facilement et suivez leur statut</p>
                    </div>
                </div>
                <a href="{% url 'front_web:client_dashboard' %}"
                    class="px-4 py-2 rounded-xl bg-white/80 hover:bg-white border border-pink-200 text-gray-700 hover:text-pink-600 transition-all flex items-center gap-2">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    Retour
                </a>
            </div>
        </div>

        <!-- Search & Filters -->
        <div class="filters-section">
            <div class="search-bar">
                <i data-lucide="search" class="search-icon"></i>
                <input type="text" id="searchInput" class="search-input"
                    placeholder="Rechercher un rendez-vous, un professionnel, un service...">
            </div>

            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all">
                    <i data-lucide="list" class="w-4 h-4"></i>
                    Tous
                    <span class="badge">{{ total_count }}</span>
                </button>
                {% if confirmed_count %}
                <button class="filter-tab" data-filter="confirmed">
                    <i data-lucide="check-circle" class="w-4 h-4"></i>
                    Confirm√©s
                    <span class="badge">{{ confirmed_count }}</span>
                </button>
                {% endif %}
                {% if pending_count %}
                <button class="filter-tab" data-filter="pending">
                    <i data-lucide="clock" class="w-4 h-4"></i>
                    En attente
                    <span class="badge">{{ pending_count }}</span>
                </button>
                {% endif %}
                {% if cancelled_count %}
                <button class="filter-tab" data-filter="cancelled">
                    <i data-lucide="x-circle" class="w-4 h-4"></i>
                    Annul√©s
                    <span class="badge">{{ cancelled_count }}</span>
                </button>
                {% endif %}
            </div>

            <div class="date-range">
                <input type="date" id="dateFrom" class="date-input" placeholder="Date de d√©but">
                <input type="date" id="dateTo" class="date-input" placeholder="Date de fin">
                <button id="quickToday" class="filter-tab">
                    <i data-lucide="sun" class="w-4 h-4"></i>
                    Aujourd'hui
                </button>
                <button id="quickUpcoming" class="filter-tab">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    √Ä venir
                </button>
                <button id="resetFilters" class="reset-btn">
                    <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                    R√©initialiser
                </button>
            </div>
        </div>

        <!-- Appointments Grid -->
        {% if confirmed or pending or cancelled %}
        <div class="appointments-grid" id="appointmentsGrid">
            {% for a in confirmed %}
            <div class="appointment-card confirmed" data-status="confirmed" data-date="{{ a.start|date:'Y-m-d' }}"
                data-search="{{ a.service_name }} {{ a.center_name }}" data-appointment-id="{{ a.id }}">
                <div class="card-header">
                    <div>
                        <h3 class="service-name">{{ a.service_name }}</h3>
                        <p class="center-name">{{ a.center_name }}</p>
                    </div>
                    <span class="status-badge confirmed">
                        <i data-lucide="check-circle" class="w-3 h-3"></i>
                        Confirm√©
                    </span>
                </div>
                <div class="card-meta">
                    <div class="meta-item">
                        <i data-lucide="calendar" class="w-4 h-4"></i>
                        {{ a.start|date:"d/m/Y" }}
                    </div>
                    <div class="meta-item">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        {{ a.start|date:"H:i" }}
                    </div>
                    <div class="meta-item price">
                        <i data-lucide="banknote" class="w-4 h-4"></i>
                        {{ a.price }} DT
                    </div>
                </div>
                <div class="card-actions">
                    <button class="action-btn primary" data-modal-id="{{ a.id }}" data-modal-status="confirmed">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                        Voir d√©tails
                    </button>

                </div>
                <script type="application/json" class="appointment-data">
                {
                    "id": {{ a.id }},
                    "service_name": "{{ a.service_name|escapejs }}",
                    "center_name": "{{ a.center_name|escapejs }}",
                    "date": "{{ a.start|date:'Y-m-d' }}",
                    "time": "{{ a.start|date:'H:i' }}",
                    "end_time": "{{ a.end|date:'H:i' }}",
                    "price": "{{ a.price }}",
                    "status": "confirmed",
                    "professional_phone": "{{ a.professional_phone|default:''|escapejs }}",
                    "professional_email": "{{ a.professional_email|default:''|escapejs }}",
                    "professional_address": "{{ a.professional_address|default:''|escapejs }}",
                    "business_name": "{{ a.business_name|default:''|escapejs }}",
                    "map_url": "{{ a.map_url|default:''|escapejs }}"
                }
                </script>
            </div>
            {% endfor %}

            {% for a in pending %}
            <div class="appointment-card pending" data-status="pending" data-date="{{ a.start|date:'Y-m-d' }}"
                data-search="{{ a.service_name }} {{ a.center_name }}" data-appointment-id="{{ a.id }}">
                <div class="card-header">
                    <div>
                        <h3 class="service-name">{{ a.service_name }}</h3>
                        <p class="center-name">{{ a.center_name }}</p>
                    </div>
                    <span class="status-badge pending">
                        <i data-lucide="clock" class="w-3 h-3"></i>
                        En attente
                    </span>
                </div>
                <div class="card-meta">
                    <div class="meta-item">
                        <i data-lucide="calendar" class="w-4 h-4"></i>
                        {{ a.start|date:"d/m/Y" }}
                    </div>
                    <div class="meta-item">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        {{ a.start|date:"H:i" }}
                    </div>
                    <div class="meta-item price">
                        <i data-lucide="banknote" class="w-4 h-4"></i>
                        {{ a.price }} DT
                    </div>
                </div>
                <div class="card-actions">
                    <button class="action-btn primary" data-modal-id="{{ a.id }}" data-modal-status="pending">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                        Voir d√©tails
                    </button>
                </div>
                <script type="application/json" class="appointment-data">
                {
                    "id": {{ a.id }},
                    "service_name": "{{ a.service_name|escapejs }}",
                    "center_name": "{{ a.center_name|escapejs }}",
                    "date": "{{ a.start|date:'Y-m-d' }}",
                    "time": "{{ a.start|date:'H:i' }}",
                    "end_time": "{{ a.end|date:'H:i' }}",
                    "price": "{{ a.price }}",
                    "status": "pending",
                    "professional_phone": "{{ a.professional_phone|default:''|escapejs }}",
                    "professional_email": "{{ a.professional_email|default:''|escapejs }}",
                    "professional_address": "{{ a.professional_address|default:''|escapejs }}",
                    "business_name": "{{ a.business_name|default:''|escapejs }}",
                    "map_url": "{{ a.map_url|default:''|escapejs }}"
                }
                </script>
            </div>
            {% endfor %}

            {% for a in cancelled %}
            <div class="appointment-card cancelled" data-status="cancelled" data-date="{{ a.start|date:'Y-m-d' }}"
                data-search="{{ a.service_name }} {{ a.center_name }}" data-appointment-id="{{ a.id }}">
                <div class="card-header">
                    <div>
                        <h3 class="service-name">{{ a.service_name }}</h3>
                        <p class="center-name">{{ a.center_name }}</p>
                    </div>
                    <span class="status-badge cancelled">
                        <i data-lucide="x-circle" class="w-3 h-3"></i>
                        Annul√©
                    </span>
                </div>
                <div class="card-meta">
                    <div class="meta-item">
                        <i data-lucide="calendar" class="w-4 h-4"></i>
                        {{ a.start|date:"d/m/Y" }}
                    </div>
                    <div class="meta-item">
                        <i data-lucide="clock" class="w-4 h-4"></i>
                        {{ a.start|date:"H:i" }} - {{ a.end|date:"H:i" }}
                    </div>
                    <div class="meta-item price">
                        <i data-lucide="banknote" class="w-4 h-4"></i>
                        {{ a.price }} DT
                    </div>
                </div>
                <div class="card-actions">
                    <button class="action-btn primary" data-modal-id="{{ a.id }}" data-modal-status="cancelled">
                        <i data-lucide="eye" class="w-4 h-4"></i>
                        Voir d√©tails
                    </button>
                </div>
                <script type="application/json" class="appointment-data">
                {
                    "id": {{ a.id }},
                    "service_name": "{{ a.service_name|escapejs }}",
                    "center_name": "{{ a.center_name|escapejs }}",
                    "date": "{{ a.start|date:'Y-m-d' }}",
                    "time": "{{ a.start|date:'H:i' }}",
                    "end_time": "{{ a.end|date:'H:i' }}",
                    "price": "{{ a.price }}",
                    "status": "cancelled",
                    "professional_phone": "{{ a.professional_phone|default:''|escapejs }}",
                    "professional_email": "{{ a.professional_email|default:''|escapejs }}",
                    "professional_address": "{{ a.professional_address|default:''|escapejs }}",
                    "business_name": "{{ a.business_name|default:''|escapejs }}",
                    "map_url": "{{ a.map_url|default:''|escapejs }}"
                }
                </script>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <div class="pagination-container" id="paginationContainer" style="display: none;">
            <button class="pagination-btn" id="prevPageBtn" disabled>
                <i data-lucide="chevron-left" class="w-4 h-4"></i>
                Pr√©c√©dent
            </button>
            <div class="pagination-info" id="paginationInfo"></div>
            <div id="paginationNumbers" style="display: flex; gap: 0.5rem;"></div>
            <button class="pagination-btn" id="nextPageBtn">
                Suivant
                <i data-lucide="chevron-right" class="w-4 h-4"></i>
            </button>
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">
                <i data-lucide="calendar-x" class="w-12 h-12 text-white"></i>
            </div>
            <h3 class="empty-title">Vous n'avez pas encore de rendez-vous √† venir üå∏</h3>
            <p class="empty-message">D√©couvrez nos professionnels et r√©servez votre premier rendez-vous !</p>
            <a href="{% url 'front_web:home' %}" class="action-btn primary inline-flex">
                <i data-lucide="sparkles" class="w-4 h-4"></i>
                D√©couvrir les professionnels
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Floating Action Button -->
    <a href="{% url 'front_web:home' %}" class="fab" aria-label="Nouveau rendez-vous">
        <i data-lucide="plus" class="w-6 h-6"></i>
    </a>

    <!-- Detail Drawer (Side Panel) -->
    <div class="drawer-overlay" id="drawerOverlay"></div>
    <div class="detail-drawer" id="detailDrawer">
        <div class="drawer-header">
            <button class="drawer-close-btn" id="closeDrawerBtn">
                <i data-lucide="x" class="w-5 h-5"></i>
            </button>
            <div id="drawerContent"></div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>
</div>

<script src="https://unpkg.com/lucide@latest"></script>
<script>
    // Initialize Lucide icons
    if (window.lucide) {
        window.lucide.createIcons();
    }

    // Filter and search functionality with pagination
    document.addEventListener('DOMContentLoaded', function () {
        const filterTabs = document.querySelectorAll('.filter-tab');
        const appointments = Array.from(document.querySelectorAll('.appointment-card'));
        const searchInput = document.getElementById('searchInput');
        const dateFrom = document.getElementById('dateFrom');
        const dateTo = document.getElementById('dateTo');
        const resetBtn = document.getElementById('resetFilters');
        const quickToday = document.getElementById('quickToday');
        const quickUpcoming = document.getElementById('quickUpcoming');

        // Pagination elements
        const paginationContainer = document.getElementById('paginationContainer');
        const prevPageBtn = document.getElementById('prevPageBtn');
        const nextPageBtn = document.getElementById('nextPageBtn');
        const paginationInfo = document.getElementById('paginationInfo');
        const paginationNumbers = document.getElementById('paginationNumbers');

        // Pagination state
        let currentPage = 1;
        const itemsPerPage = 9; // 3x3 grid on desktop
        let filteredAppointments = [];

        function applyFilters() {
            const activeFilter = document.querySelector('.filter-tab.active')?.dataset.filter || 'all';
            const searchTerm = (searchInput?.value || '').toLowerCase();
            const fromDate = dateFrom?.value ? new Date(dateFrom.value + 'T00:00:00') : null;
            const toDate = dateTo?.value ? new Date(dateTo.value + 'T23:59:59') : null;

            // Filter appointments
            filteredAppointments = appointments.filter(card => {
                const status = card.dataset.status;
                const searchText = (card.dataset.search || '').toLowerCase();
                const cardDate = new Date(card.dataset.date + 'T00:00:00');

                // Status filter
                if (activeFilter !== 'all' && status !== activeFilter) {
                    return false;
                }

                // Search filter
                if (searchTerm && !searchText.includes(searchTerm)) {
                    return false;
                }

                // Date filter
                if (fromDate && cardDate < fromDate) {
                    return false;
                }
                if (toDate && cardDate > toDate) {
                    return false;
                }

                return true;
            });

            // Reset to first page when filters change
            currentPage = 1;
            displayPage();
        }

        function displayPage() {
            // Hide all appointments first
            appointments.forEach(card => {
                card.style.display = 'none';
            });

            // Calculate pagination
            const totalPages = Math.ceil(filteredAppointments.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const currentAppointments = filteredAppointments.slice(startIndex, endIndex);

            // Show current page appointments
            currentAppointments.forEach(card => {
                card.style.display = 'block';
                card.style.animation = 'cardSlideIn 0.4s ease-out';
            });

            // Update pagination controls
            updatePaginationControls(totalPages);

            // Show/hide empty state
            const grid = document.getElementById('appointmentsGrid');
            if (filteredAppointments.length === 0) {
                let emptyState = grid.querySelector('.empty-state');
                if (!emptyState) {
                    emptyState = document.createElement('div');
                    emptyState.className = 'empty-state';
                    grid.appendChild(emptyState);
                }
                emptyState.innerHTML = `
                    <div class="empty-icon">
                        <i data-lucide="search-x" class="w-12 h-12 text-white"></i>
                    </div>
                    <h3 class="empty-title">Aucun r√©sultat trouv√©</h3>
                    <p class="empty-message">Essayez de modifier vos crit√®res de recherche</p>
                `;
                if (window.lucide) window.lucide.createIcons();
                paginationContainer.style.display = 'none';
            } else {
                const existingEmpty = grid.querySelector('.empty-state');
                if (existingEmpty) {
                    existingEmpty.remove();
                }
                paginationContainer.style.display = totalPages > 1 ? 'flex' : 'none';
            }
        }

        function updatePaginationControls(totalPages) {
            // Update info
            const startIndex = (currentPage - 1) * itemsPerPage + 1;
            const endIndex = Math.min(currentPage * itemsPerPage, filteredAppointments.length);
            paginationInfo.textContent = `${startIndex}-${endIndex} sur ${filteredAppointments.length}`;

            // Update buttons
            prevPageBtn.disabled = currentPage === 1;
            nextPageBtn.disabled = currentPage === totalPages;

            // Update page numbers
            paginationNumbers.innerHTML = '';
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            // First page
            if (startPage > 1) {
                const btn = createPageButton(1, currentPage === 1);
                paginationNumbers.appendChild(btn);
                if (startPage > 2) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '0 0.5rem';
                    ellipsis.style.color = 'var(--texte-secondaire)';
                    paginationNumbers.appendChild(ellipsis);
                }
            }

            // Page numbers
            for (let i = startPage; i <= endPage; i++) {
                const btn = createPageButton(i, currentPage === i);
                paginationNumbers.appendChild(btn);
            }

            // Last page
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    const ellipsis = document.createElement('span');
                    ellipsis.textContent = '...';
                    ellipsis.style.padding = '0 0.5rem';
                    ellipsis.style.color = 'var(--texte-secondaire)';
                    paginationNumbers.appendChild(ellipsis);
                }
                const btn = createPageButton(totalPages, currentPage === totalPages);
                paginationNumbers.appendChild(btn);
            }

            if (window.lucide) window.lucide.createIcons();
        }

        function createPageButton(pageNum, isActive) {
            const btn = document.createElement('button');
            btn.className = `pagination-btn ${isActive ? 'active' : ''}`;
            btn.textContent = pageNum;
            btn.addEventListener('click', () => {
                currentPage = pageNum;
                displayPage();
                // Scroll to top of grid
                document.getElementById('appointmentsGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
            });
            return btn;
        }

        // Pagination navigation
        prevPageBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayPage();
                document.getElementById('appointmentsGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });

        nextPageBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredAppointments.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                displayPage();
                document.getElementById('appointmentsGrid').scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });

        // Filter tabs
        filterTabs.forEach(tab => {
            tab.addEventListener('click', function () {
                if (this.dataset.filter) {
                    filterTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    applyFilters();
                }
            });
        });

        // Search input
        if (searchInput) {
            let searchTimeout;
            searchInput.addEventListener('input', function () {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(applyFilters, 300);
            });
        }

        // Date filters
        if (dateFrom) dateFrom.addEventListener('change', applyFilters);
        if (dateTo) dateTo.addEventListener('change', applyFilters);

        // Reset button
        if (resetBtn) {
            resetBtn.addEventListener('click', function () {
                filterTabs.forEach(t => t.classList.remove('active'));
                document.querySelector('[data-filter="all"]')?.classList.add('active');
                if (searchInput) searchInput.value = '';
                if (dateFrom) dateFrom.value = '';
                if (dateTo) dateTo.value = '';
                applyFilters();
            });
        }

        // Quick filters
        if (quickToday) {
            quickToday.addEventListener('click', function () {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                const todayStr = `${yyyy}-${mm}-${dd}`;
                if (dateFrom) dateFrom.value = todayStr;
                if (dateTo) dateTo.value = todayStr;
                applyFilters();
            });
        }

        if (quickUpcoming) {
            quickUpcoming.addEventListener('click', function () {
                const today = new Date();
                const yyyy = today.getFullYear();
                const mm = String(today.getMonth() + 1).padStart(2, '0');
                const dd = String(today.getDate()).padStart(2, '0');
                const todayStr = `${yyyy}-${mm}-${dd}`;
                if (dateFrom) dateFrom.value = todayStr;
                if (dateTo) dateTo.value = '';
                applyFilters();
            });
        }

        // Initial filter application - Show today's appointments by default
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        const todayStr = `${yyyy}-${mm}-${dd}`;
        if (dateFrom) dateFrom.value = todayStr;
        if (dateTo) dateTo.value = todayStr;

        // Auto-click "Aujourd'hui" button if it exists
        if (quickToday) {
            quickToday.click();
        } else {
            applyFilters();
        }

        // Drawer buttons event listeners
        document.querySelectorAll('[data-modal-id]').forEach(btn => {
            btn.addEventListener('click', function () {
                const appointmentId = parseInt(this.dataset.modalId);
                const status = this.dataset.modalStatus;
                openDetailDrawer(appointmentId, status);
            });
        });
    });

    // Detail Drawer Functions
    function openDetailDrawer(appointmentId, status) {
        const card = document.querySelector(`[data-appointment-id="${appointmentId}"]`);
        if (!card) return;

        const dataScript = card.querySelector('.appointment-data');
        if (!dataScript) return;

        try {
            const data = JSON.parse(dataScript.textContent);
            const drawer = document.getElementById('detailDrawer');
            const drawerContent = document.getElementById('drawerContent');
            const overlay = document.getElementById('drawerOverlay');

            const statusConfig = {
                confirmed: { label: 'Confirm√©', color: 'green', icon: 'check-circle' },
                pending: { label: 'En attente', color: 'yellow', icon: 'clock' },
                cancelled: { label: 'Annul√©', color: 'red', icon: 'x-circle' }
            };

            const config = statusConfig[status] || statusConfig.confirmed;

            drawerContent.innerHTML = `
                <div class="detail-section">
                    <h2 class="service-name mb-4" style="font-size: 1.75rem;">${data.service_name}</h2>
                    <span class="status-badge ${status}">
                        <i data-lucide="${config.icon}" class="w-3 h-3"></i>
                        ${config.label}
                    </span>
                </div>

                <div class="detail-section">
                    <h3 class="detail-section-title">
                        <i data-lucide="calendar" class="w-5 h-5"></i>
                        Informations du rendez-vous
                    </h3>
                    <div class="professional-info">
                        <div class="info-item">
                            <i data-lucide="calendar" class="w-4 h-4"></i>
                            <span><strong>Date:</strong> ${new Date(data.date).toLocaleDateString('fr-FR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}</span>
                        </div>
                        <div class="info-item">
                            <i data-lucide="clock" class="w-4 h-4"></i>
                            <span><strong>Heure:</strong> ${data.time}${data.end_time ? ' - ' + data.end_time : ''}</span>
                        </div>
                        <div class="info-item">
                            <i data-lucide="banknote" class="w-4 h-4"></i>
                            <span><strong>Prix:</strong> ${data.price} DT</span>
                        </div>
                        <div class="info-item">
                            <i data-lucide="building" class="w-4 h-4"></i>
                            <span><strong>Centre:</strong> ${data.center_name}</span>
                        </div>
                    </div>
                </div>

                ${data.professional_phone || data.professional_email || data.professional_address || data.map_url ? `
                <div class="detail-section">
                    <h3 class="detail-section-title">
                        <i data-lucide="store" class="w-5 h-5"></i>
                        Informations du salon
                    </h3>
                    <div class="professional-info">
                        ${data.business_name ? `
                        <div class="info-item">
                            <i data-lucide="briefcase" class="w-4 h-4"></i>
                            <span><strong>${data.business_name}</strong></span>
                        </div>
                        ` : ''}
                        ${data.professional_phone ? `
                        <div class="info-item">
                            <i data-lucide="phone" class="w-4 h-4"></i>
                            <a href="tel:${data.professional_phone}" style="color: #FF8DC7; text-decoration: none; font-weight: 600;">${data.professional_phone}</a>
                        </div>
                        ` : ''}
                        ${data.professional_email ? `
                        <div class="info-item">
                            <i data-lucide="mail" class="w-4 h-4"></i>
                            <a href="mailto:${data.professional_email}" style="color: #FF8DC7; text-decoration: none; font-weight: 600;">${data.professional_email}</a>
                        </div>
                        ` : ''}
                        ${data.professional_address ? `
                        <div class="info-item">
                            <i data-lucide="map-pin" class="w-4 h-4"></i>
                            <span>${data.professional_address}</span>
                        </div>
                        ` : ''}
                        ${data.map_url ? `
                        <div class="info-item">
                            <i data-lucide="map" class="w-4 h-4"></i>
                            <a href="${data.map_url}" target="_blank" rel="noopener" style="color: #FF8DC7; text-decoration: none; font-weight: 600;">Voir sur Google Maps <i data-lucide="external-link" class="w-3 h-3 inline"></i></a>
                        </div>
                        ` : ''}
                    </div>
                </div>
                ` : ''}

                <div class="card-actions mt-6">
                    <a href="{% url 'front_web:client_calendar' %}" class="action-btn primary" style="display: flex; align-items: center; justify-content: center;">
                        <i data-lucide="calendar-plus" class="w-4 h-4"></i>
                        Voir le calendrier
                    </a>
                </div>
            `;

            if (window.lucide) window.lucide.createIcons();
            drawer.classList.add('active');
            overlay.classList.add('active');
            document.body.style.overflow = 'hidden';
        } catch (error) {
            console.error('Error parsing appointment data:', error);
        }
    }

    function closeDetailDrawer(event) {
        if (event) {
            event.preventDefault();
            event.stopPropagation();
        }
        const drawer = document.getElementById('detailDrawer');
        const overlay = document.getElementById('drawerOverlay');
        drawer.classList.remove('active');
        overlay.classList.remove('active');
        document.body.style.overflow = '';
    }

    // Close drawer on Escape key
    document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape') {
            closeDetailDrawer();
        }
    });

    // Drawer close button and overlay click
    const closeDrawerBtn = document.getElementById('closeDrawerBtn');
    const drawerOverlay = document.getElementById('drawerOverlay');
    const drawer = document.getElementById('detailDrawer');

    if (closeDrawerBtn) {
        closeDrawerBtn.addEventListener('click', closeDetailDrawer);
    }

    if (drawerOverlay) {
        drawerOverlay.addEventListener('click', closeDetailDrawer);
    }

    if (drawer) {
        drawer.addEventListener('click', function (e) {
            e.stopPropagation();
        });
    }
</script>
{% endblock %}