{% extends 'front_web/base_prof.html' %}
{% load static %}
{% block title %}Rendez-vous - Pro{% endblock %}

{% block extra_css %}
<style>
    .gradient-text {
        background: linear-gradient(135deg, #ec4899 0%, #3b82f6 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .appointment-card {
        background: linear-gradient(135deg, rgba(255, 255, 255, .85), rgba(255, 255, 255, .65));
        border: 1px solid rgba(255, 255, 255, .8);
        border-radius: 20px;
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        box-shadow: 0 8px 32px rgba(16, 24, 40, .08);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .appointment-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #ec4899, #3b82f6);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .appointment-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(16, 24, 40, .15);
        border-color: rgba(255, 255, 255, .9);
    }

    .appointment-card:hover::before {
        opacity: 1;
    }

    .status-badge {
        padding: 6px 14px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255, 255, 255, .4);
    }

    .status-pending {
        background: linear-gradient(135deg, rgba(251, 191, 36, .2), rgba(245, 158, 11, .2));
        color: #b45309;
        border-color: rgba(251, 191, 36, .3);
    }

    .status-confirmed {
        background: linear-gradient(135deg, rgba(34, 197, 94, .2), rgba(22, 163, 74, .2));
        color: #15803d;
        border-color: rgba(34, 197, 94, .3);
    }

    .action-button {
        padding: 10px 18px;
        border-radius: 12px;
        font-weight: 600;
        font-size: 14px;
        border: none;
        backdrop-filter: blur(8px);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 6px;
    }

    .action-accept {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        box-shadow: 0 4px 12px rgba(16, 185, 129, .3);
    }

    .action-accept:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(16, 185, 129, .4);
        background: linear-gradient(135deg, #059669, #047857);
    }

    .action-reject {
        background: linear-gradient(135deg, #ef4444, #dc2626);
        color: white;
        box-shadow: 0 4px 12px rgba(239, 68, 68, .3);
    }

    .action-reject:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(239, 68, 68, .4);
        background: linear-gradient(135deg, #dc2626, #b91c1c);
    }

    .notification-panel {
        background: linear-gradient(135deg, rgba(255, 255, 255, .9), rgba(255, 255, 255, .7));
        border: 1px solid rgba(255, 255, 255, .8);
        border-radius: 24px;
        backdrop-filter: blur(16px);
        box-shadow: 0 12px 40px rgba(16, 24, 40, .1);
    }

    .notification-item {
        background: linear-gradient(135deg, rgba(248, 250, 252, .8), rgba(241, 245, 249, .6));
        border: 1px solid rgba(226, 232, 240, .5);
        border-radius: 16px;
        transition: all 0.2s ease;
    }

    .notification-item:hover {
        transform: translateX(4px);
        box-shadow: 0 4px 12px rgba(16, 24, 40, .08);
    }

    .stats-counter {
        background: linear-gradient(135deg, rgba(255, 255, 255, .95), rgba(255, 255, 255, .85));
        border: 1px solid rgba(255, 255, 255, .6);
        border-radius: 16px;
        padding: 8px 16px;
        font-weight: 700;
        font-size: 13px;
        letter-spacing: 0.5px;
        backdrop-filter: blur(8px);
        box-shadow: 0 4px 12px rgba(16, 24, 40, .06);
    }

    .counter-pending {
        color: #d97706;
        background: linear-gradient(135deg, rgba(251, 191, 36, .15), rgba(245, 158, 11, .1));
        border-color: rgba(251, 191, 36, .2);
    }

    .counter-confirmed {
        color: #059669;
        background: linear-gradient(135deg, rgba(34, 197, 94, .15), rgba(22, 163, 74, .1));
        border-color: rgba(34, 197, 94, .2);
    }

    /* ==========================
       RESPONSIVE MOBILE OPTIMIZATIONS
       ========================== */
    @media (max-width: 768px) {

        /* Mobile body */
        body {
            font-size: 16px !important;
            -webkit-text-size-adjust: 100%;
        }

        /* Hide blob animations on mobile */
        .animate-blob-1,
        .animate-blob-2 {
            display: none !important;
        }

        /* Container mobile */
        .max-w-7xl {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        .px-6 {
            padding-left: 1rem !important;
            padding-right: 1rem !important;
        }

        .py-10 {
            padding-top: 1.5rem !important;
            padding-bottom: 1.5rem !important;
        }

        /* Header mobile */
        .flex.items-center.justify-between.mb-10 {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 1rem !important;
            margin-bottom: 1.5rem !important;
        }

        .w-16.h-16 {
            width: 3rem !important;
            height: 3rem !important;
        }

        .w-16.h-16 [data-lucide] {
            width: 1.5rem !important;
            height: 1.5rem !important;
        }

        h1.text-4xl {
            font-size: 1.5rem !important;
            margin-bottom: 0.5rem !important;
        }

        .text-gray-600.text-lg {
            font-size: 0.9375rem !important;
        }

        /* Back button mobile */
        .kpi-glass.px-6 {
            width: 100%;
            justify-content: center;
            padding: 0.875rem 1rem !important;
        }

        /* Notifications panel mobile */
        .notification-panel {
            padding: 1rem !important;
            border-radius: 1.5rem !important;
            margin-bottom: 1.5rem !important;
        }

        .notification-panel .w-12.h-12 {
            width: 2.5rem !important;
            height: 2.5rem !important;
        }

        .notification-panel h2.text-xl {
            font-size: 1.125rem !important;
        }

        .notification-panel .text-sm {
            font-size: 0.8125rem !important;
        }

        /* Notifications grid mobile */
        .grid.grid-cols-1.lg\\:grid-cols-2 {
            grid-template-columns: 1fr !important;
            gap: 0.75rem !important;
        }

        .notification-item {
            padding: 0.875rem !important;
        }

        .notification-item .w-10.h-10 {
            width: 2rem !important;
            height: 2rem !important;
        }

        .notification-item .w-10.h-10 [data-lucide] {
            width: 1rem !important;
            height: 1rem !important;
        }

        .notification-item .font-semibold {
            font-size: 0.875rem !important;
        }

        .notification-item .text-sm {
            font-size: 0.75rem !important;
        }

        .notification-item .text-xs {
            font-size: 0.6875rem !important;
        }

        /* Appointments grid mobile */
        .grid.grid-cols-1.xl\\:grid-cols-2 {
            grid-template-columns: 1fr !important;
            gap: 1.5rem !important;
        }

        /* KPI glass cards mobile */
        .kpi-glass {
            padding: 1rem !important;
        }

        .kpi-glass .w-12.h-12 {
            width: 2.5rem !important;
            height: 2.5rem !important;
        }

        .kpi-glass .w-12.h-12 [data-lucide] {
            width: 1.25rem !important;
            height: 1.25rem !important;
        }

        .kpi-glass h2.text-xl {
            font-size: 1.125rem !important;
        }

        .kpi-glass .text-sm {
            font-size: 0.8125rem !important;
        }

        /* Stats counter mobile */
        .stats-counter {
            padding: 0.5rem 0.875rem !important;
            font-size: 0.75rem !important;
        }

        /* Appointment cards mobile */
        .appointment-card {
            padding: 1rem !important;
            border-radius: 1rem !important;
        }

        .appointment-card .w-10.h-10 {
            width: 2rem !important;
            height: 2rem !important;
        }

        .appointment-card .w-10.h-10 [data-lucide] {
            width: 1.125rem !important;
            height: 1.125rem !important;
        }

        .appointment-card h3 {
            font-size: 0.9375rem !important;
        }

        .appointment-card .text-sm {
            font-size: 0.75rem !important;
        }

        .appointment-card .text-xs {
            font-size: 0.6875rem !important;
        }

        /* Status badge mobile */
        .status-badge {
            padding: 0.375rem 0.75rem !important;
            font-size: 0.625rem !important;
        }

        /* Info grids mobile */
        .grid.grid-cols-2 {
            grid-template-columns: 1fr 1fr !important;
            gap: 0.75rem !important;
        }

        /* Client info mobile */
        .appointment-card .p-3 {
            padding: 0.75rem !important;
        }

        .appointment-card .w-4.h-4 {
            width: 0.875rem !important;
            height: 0.875rem !important;
        }

        .appointment-card .w-3.h-3 {
            width: 0.75rem !important;
            height: 0.75rem !important;
        }

        /* Action buttons mobile */
        .action-button {
            padding: 0.75rem 1rem !important;
            font-size: 0.8125rem !important;
            min-height: 44px;
        }

        .action-button [data-lucide] {
            width: 0.875rem !important;
            height: 0.875rem !important;
        }

        /* Empty state mobile */
        .text-center.py-12 {
            padding: 2rem 1rem !important;
        }

        .w-16.h-16.rounded-full {
            width: 4rem !important;
            height: 4rem !important;
        }

        .text-lg.font-semibold {
            font-size: 1rem !important;
        }

        /* Scrollable areas mobile */
        .space-y-4.max-h-96 {
            max-height: none !important;
        }

        .space-y-4>*+* {
            margin-top: 0.75rem !important;
        }

        /* Spacing adjustments */
        .mb-6 {
            margin-bottom: 1rem !important;
        }

        .mb-4 {
            margin-bottom: 0.75rem !important;
        }

        .gap-8 {
            gap: 1.5rem !important;
        }

        .gap-6 {
            gap: 1rem !important;
        }

        .gap-4 {
            gap: 0.75rem !important;
        }

        .gap-3 {
            gap: 0.5rem !important;
        }

        .gap-2 {
            gap: 0.375rem !important;
        }
    }

    /* Small mobile (iPhone SE) */
    @media (max-width: 375px) {
        h1.text-4xl {
            font-size: 1.25rem !important;
        }

        .kpi-glass,
        .notification-panel {
            padding: 0.75rem !important;
        }

        .appointment-card {
            padding: 0.75rem !important;
        }

        .action-button {
            padding: 0.625rem 0.875rem !important;
            font-size: 0.75rem !important;
        }

        .grid.grid-cols-2 {
            grid-template-columns: 1fr !important;
            gap: 0.5rem !important;
        }
    }

    /* Landscape mobile */
    @media (max-width: 768px) and (orientation: landscape) {
        .py-10 {
            padding-top: 1rem !important;
            padding-bottom: 1rem !important;
        }

        .grid.grid-cols-1.xl\\:grid-cols-2 {
            grid-template-columns: repeat(2, 1fr) !important;
        }

        .space-y-4.max-h-96 {
            max-height: 50vh !important;
            overflow-y: auto !important;
        }
    }

    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {

        .appointment-card,
        .action-button,
        .notification-item {
            -webkit-tap-highlight-color: rgba(242, 139, 178, 0.2);
        }

        * {
            -webkit-overflow-scrolling: touch;
        }

        .action-button:active {
            opacity: 0.85;
            transform: scale(0.98);
        }

        .appointment-card:hover {
            transform: translateY(-4px) scale(1.01);
        }
    }

    /* iOS Safari fixes */
    @supports (-webkit-touch-callout: none) {
        .min-h-screen {
            min-height: -webkit-fill-available;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-pink-50 via-white to-blue-50 relative">
    <!-- Animated background blobs -->
    <div class="absolute inset-0 overflow-hidden pointer-events-none">
        <div class="absolute rounded-full mix-blend-multiply filter blur-2xl opacity-20 animate-blob-1 bg-pink-300"
            style="width: 400px; height: 400px; top: 10%; left: 10%;"></div>
        <div class="absolute rounded-full mix-blend-multiply filter blur-2xl opacity-20 animate-blob-2 bg-blue-300"
            style="width: 350px; height: 350px; bottom: 10%; right: 15%;"></div>
    </div>

    <div class="relative z-10 max-w-7xl mx-auto px-6 py-10">
        <!-- Header Section -->
        <div class="flex items-center justify-between mb-10">
            <div class="flex items-center gap-4">
                <div
                    class="w-16 h-16 rounded-2xl bg-gradient-to-br from-pink-400 to-blue-500 flex items-center justify-center shadow-xl">
                    <i data-lucide="calendar-heart" class="w-8 h-8 text-white"></i>
                </div>
                <div>
                    <h1 class="text-4xl font-bold gradient-text mb-2">Gestion des Rendez-vous</h1>
                    <p class="text-gray-600 text-lg">Gérez vos demandes et confirmations en temps réel</p>
                </div>
            </div>
            <a href="{% url 'front_web:pro_dashboard' %}"
                class="kpi-glass px-6 py-3 rounded-xl font-semibold text-gray-700 hover:text-pink-600 transition-colors flex items-center gap-2">
                <i data-lucide="arrow-left" class="w-5 h-5"></i>
                Tableau de bord
            </a>
        </div>


        <!-- Notifications Panel -->
        {% if recent_notifications %}
        <div class="notification-panel p-8 mb-8">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <div
                        class="w-12 h-12 rounded-xl bg-gradient-to-br from-blue-400 to-indigo-500 flex items-center justify-center shadow-lg">
                        <i data-lucide="bell-ring" class="w-6 h-6 text-white"></i>
                    </div>
                    <div>
                        <h2 class="text-xl font-bold text-gray-900">Notifications récentes</h2>
                        <p class="text-gray-600 text-sm">Suivez l'activité de vos rendez-vous</p>
                    </div>
                </div>
                {% if unread_count > 0 %}
                <div class="flex items-center gap-2">
                    <div class="w-3 h-3 bg-red-400 rounded-full animate-pulse"></div>
                    <span class="stats-counter bg-gradient-to-r from-red-100 to-red-50 text-red-700 border-red-200">
                        {{ unread_count }} non lues</span>
                </div>
                {% endif %}
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 max-h-80 overflow-y-auto">
                {% for notification in recent_notifications|slice:":6" %}
                <div
                    class="notification-item p-4 {% if not notification.is_read %}border-l-4 border-l-blue-400{% endif %}">
                    <div class="flex items-start gap-4">
                        <div class="flex-shrink-0">
                            <div
                                class="w-10 h-10 rounded-xl flex items-center justify-center {% if 'demande' in notification.title %}bg-gradient-to-br from-blue-400 to-blue-500{% elif 'confirmé' in notification.title %}bg-gradient-to-br from-green-400 to-green-500{% elif 'annulé' in notification.title %}bg-gradient-to-br from-red-400 to-red-500{% else %}bg-gradient-to-br from-gray-400 to-gray-500{% endif %}">
                                {% if 'demande' in notification.title %}
                                <i data-lucide="calendar-plus" class="w-5 h-5 text-white"></i>
                                {% elif 'confirmé' in notification.title %}
                                <i data-lucide="check-circle-2" class="w-5 h-5 text-white"></i>
                                {% elif 'annulé' in notification.title %}
                                <i data-lucide="x-circle" class="w-5 h-5 text-white"></i>
                                {% else %}
                                <i data-lucide="bell" class="w-5 h-5 text-white"></i>
                                {% endif %}
                            </div>
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="font-semibold text-gray-900 mb-1">{{ notification.title }}</div>
                            <div class="text-sm text-gray-600 mb-2 line-clamp-2">{{ notification.body }}</div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="clock" class="w-3 h-3 text-gray-400"></i>
                                <span class="text-xs text-gray-500">{{ notification.created_at|timesince }}</span>
                                {% if not notification.is_read %}
                                <span class="ml-auto w-2 h-2 bg-blue-400 rounded-full"></span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Appointments Sections -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
            <!-- Demandes en attente -->
            <div class="kpi-glass p-8">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-12 h-12 rounded-xl bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center shadow-lg">
                            <i data-lucide="clock" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900">Demandes en attente</h2>
                            <p class="text-gray-600 text-sm">Nouvelles demandes de vos clients</p>
                        </div>
                    </div>
                    <span class="stats-counter counter-pending">{{ pending|length }}</span>
                </div>

                {% if pending %}
                <div class="space-y-4 max-h-96 overflow-y-auto">
                    {% for a in pending %}
                    <div class="appointment-card p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center">
                                    <i data-lucide="user-circle" class="w-5 h-5 text-gray-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">{{ a.client_name }}</h3>
                                    <p class="text-sm text-gray-600">{{ a.service_name }}</p>
                                </div>
                            </div>
                            <span class="status-badge status-pending">En attente</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="flex items-center gap-2">
                                <i data-lucide="calendar" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm text-gray-600">{{ a.start|date:"d/m/Y" }}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="clock" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm text-gray-600">{{ a.start|date:"H:i" }}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="banknote" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm font-semibold text-gray-900">{{ a.price }} DT</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="timer" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm text-gray-600">1h</span>
                            </div>
                        </div>

                        <!-- Informations client détaillées -->
                        <div class="mb-4 p-3 bg-blue-50 rounded-lg">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="user" class="w-4 h-4 text-blue-500"></i>
                                <span class="text-sm font-medium text-blue-700">Informations client</span>
                            </div>
                            <div class="grid grid-cols-1 gap-2 text-xs">
                                {% if a.client_email %}
                                <div class="flex items-center gap-2">
                                    <i data-lucide="mail" class="w-3 h-3 text-blue-400"></i>
                                    <span class="text-blue-600">{{ a.client_email }}</span>
                                </div>
                                {% endif %}
                                {% if a.client_phone %}
                                <div class="flex items-center gap-2">
                                    <i data-lucide="phone" class="w-3 h-3 text-blue-400"></i>
                                    <span class="text-blue-600">{{ a.client_phone }}</span>
                                </div>
                                {% endif %}
                                {% if a.client_first_name and a.client_last_name %}
                                <div class="flex items-center gap-2">
                                    <i data-lucide="user-check" class="w-3 h-3 text-blue-400"></i>
                                    <span class="text-blue-600">{{ a.client_first_name }} {{ a.client_last_name
                                        }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        {% if a.notes %}
                        <div class="mb-4 p-3 bg-gray-50 rounded-lg">
                            <div class="flex items-center gap-2 mb-1">
                                <i data-lucide="message-circle" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm font-medium text-gray-700">Note du client</span>
                            </div>
                            <p class="text-sm text-gray-600">{{ a.notes }}</p>
                        </div>
                        {% endif %}

                        <div class="flex gap-3">
                            <button onclick="proAccept({{ a.id }})" class="action-button action-accept flex-1">
                                <i data-lucide="check" class="w-4 h-4"></i>
                                Accepter
                            </button>
                            <button onclick="proReject({{ a.id }})" class="action-button action-reject flex-1">
                                <i data-lucide="x" class="w-4 h-4"></i>
                                Refuser
                            </button>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12">
                    <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="calendar-check" class="w-8 h-8 text-gray-400"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-600 mb-2">Aucune demande en attente</h3>
                    <p class="text-gray-500">Toutes vos demandes ont été traitées</p>
                </div>
                {% endif %}
            </div>

            <!-- Rendez-vous confirmés -->
            <div class="kpi-glass p-8">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-12 h-12 rounded-xl bg-gradient-to-br from-green-400 to-emerald-500 flex items-center justify-center shadow-lg">
                            <i data-lucide="calendar-check" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h2 class="text-xl font-bold text-gray-900">Rendez-vous confirmés</h2>
                            <p class="text-gray-600 text-sm">Vos prochains rendez-vous</p>
                        </div>
                    </div>
                    <span class="stats-counter counter-confirmed">{{ confirmed|length }}</span>
                </div>

                {% if confirmed %}
                <div class="space-y-4 max-h-96 overflow-y-auto">
                    {% for a in confirmed %}
                    <div class="appointment-card p-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <div
                                    class="w-10 h-10 rounded-xl bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center">
                                    <i data-lucide="user-check" class="w-5 h-5 text-green-600"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900">{{ a.client_name }}</h3>
                                    <p class="text-sm text-gray-600">{{ a.service_name }}</p>
                                </div>
                            </div>
                            <span class="status-badge status-confirmed">Confirmé</span>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div class="flex items-center gap-2">
                                <i data-lucide="calendar" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm text-gray-600">{{ a.start|date:"d/m/Y" }}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="clock" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm text-gray-600">{{ a.start|date:"H:i" }}</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="banknote" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm font-semibold text-gray-900">{{ a.price }} DT</span>
                            </div>
                            <div class="flex items-center gap-2">
                                <i data-lucide="timer" class="w-4 h-4 text-gray-500"></i>
                                <span class="text-sm text-gray-600">1h</span>
                            </div>
                        </div>

                        <!-- Informations client détaillées -->
                        <div class="mt-4 p-3 bg-green-50 rounded-lg">
                            <div class="flex items-center gap-2 mb-2">
                                <i data-lucide="user" class="w-4 h-4 text-green-500"></i>
                                <span class="text-sm font-medium text-green-700">Informations client</span>
                            </div>
                            <div class="grid grid-cols-1 gap-2 text-xs">
                                {% if a.client_email %}
                                <div class="flex items-center gap-2">
                                    <i data-lucide="mail" class="w-3 h-3 text-green-400"></i>
                                    <span class="text-green-600">{{ a.client_email }}</span>
                                </div>
                                {% endif %}
                                {% if a.client_phone %}
                                <div class="flex items-center gap-2">
                                    <i data-lucide="phone" class="w-3 h-3 text-green-400"></i>
                                    <span class="text-green-600">{{ a.client_phone }}</span>
                                </div>
                                {% endif %}
                                {% if a.client_first_name and a.client_last_name %}
                                <div class="flex items-center gap-2">
                                    <i data-lucide="user-check" class="w-3 h-3 text-green-400"></i>
                                    <span class="text-green-600">{{ a.client_first_name }} {{ a.client_last_name
                                        }}</span>
                                </div>
                                {% endif %}
                            </div>
                        </div>

                        {% if a.notes %}
                        <div class="mt-4 p-3 bg-green-100 rounded-lg">
                            <div class="flex items-center gap-2 mb-1">
                                <i data-lucide="message-circle" class="w-4 h-4 text-green-500"></i>
                                <span class="text-sm font-medium text-green-700">Note du client</span>
                            </div>
                            <p class="text-sm text-green-600">{{ a.notes }}</p>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12">
                    <div class="w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center mx-auto mb-4">
                        <i data-lucide="calendar-x" class="w-8 h-8 text-gray-400"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-600 mb-2">Aucun rendez-vous confirmé</h3>
                    <p class="text-gray-500">Vos futurs rendez-vous apparaîtront ici</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script src="https://unpkg.com/lucide@latest"></script>
<script>
    // Initialize Lucide icons
    window.lucide && window.lucide.createIcons();

    async function proAccept(id) {
        if (!confirm('Êtes-vous sûr de vouloir accepter ce rendez-vous ?')) return;

        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Traitement...';
        button.disabled = true;

        try {
            const resp = await fetch('{% url "appointments:accept_appointment" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                credentials: 'include',
                body: JSON.stringify({ appointment_id: id })
            });

            const data = await resp.json();

            if (resp.ok) {
                showNotification('Rendez-vous accepté avec succès! Le client a été notifié par email.', 'success');
                setTimeout(() => location.reload(), 1500);
            } else {
                showNotification(data.detail || 'Erreur lors de l\'acceptation', 'error');
                button.textContent = originalText;
                button.disabled = false;
            }
        } catch (error) {
            showNotification('Erreur de connexion', 'error');
            button.textContent = originalText;
            button.disabled = false;
        }
    }

    async function proReject(id) {
        if (!confirm('Êtes-vous sûr de vouloir refuser ce rendez-vous ?')) return;

        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Traitement...';
        button.disabled = true;

        try {
            const resp = await fetch('{% url "appointments:reject_appointment" %}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                credentials: 'include',
                body: JSON.stringify({ appointment_id: id })
            });

            const data = await resp.json();

            if (resp.ok) {
                showNotification('Rendez-vous refusé. Le client a été notifié par email.', 'warning');
                setTimeout(() => location.reload(), 1500);
            } else {
                showNotification(data.detail || 'Erreur lors du refus', 'error');
                button.textContent = originalText;
                button.disabled = false;
            }
        } catch (error) {
            showNotification('Erreur de connexion', 'error');
            button.textContent = originalText;
            button.disabled = false;
        }
    }

    function showNotification(message, type = 'success') {
        // Remove existing notifications
        document.querySelectorAll('.notification').forEach(n => n.remove());

        const notification = document.createElement('div');
        notification.className = `notification fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 ${type === 'success' ? 'bg-green-500 text-white' :
            type === 'warning' ? 'bg-yellow-500 text-white' :
                'bg-red-500 text-white'
            }`;
        notification.innerHTML = `
            <div class="flex items-center gap-2">
                <i data-lucide="${type === 'success' ? 'check-circle' : type === 'warning' ? 'alert-triangle' : 'x-circle'}" class="w-5 h-5"></i>
                <span>${message}</span>
            </div>
        `;

        document.body.appendChild(notification);
        window.lucide && window.lucide.createIcons();

        // Show notification
        setTimeout(() => {
            notification.classList.remove('translate-x-full');
        }, 100);

        // Auto-hide after 5 seconds
        setTimeout(() => {
            notification.classList.add('translate-x-full');
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 300);
        }, 5000);
    }
</script>
{% endblock %}
{% endblock %}