{% extends 'front_web/base_prof.html' %}
{% load static %}

{% block title %}Compléter mon profil - Coucou Beauté{% endblock %}

{% block extra_css %}
<style>
    /* ==========================
       RESPONSIVE MOBILE OPTIMIZATIONS
       ========================== */
    @media (max-width: 768px) {

        /* Mobile body */
        body {
            font-size: 16px !important;
            -webkit-text-size-adjust: 100%;
        }

        /* Container mobile */
        .max-w-4xl {
            padding: 0 1rem !important;
        }

        .p-6 {
            padding: 1rem !important;
        }

        /* Header mobile */
        .flex.items-center.justify-between {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 0.5rem !important;
        }

        h1.text-2xl {
            font-size: 1.25rem !important;
        }

        .text-xs {
            font-size: 0.75rem !important;
        }

        /* Banner mobile */
        .rounded-2xl.border {
            padding: 0.875rem !important;
        }

        .w-12.h-12 {
            width: 2.5rem !important;
            height: 2.5rem !important;
        }

        .text-sm {
            font-size: 0.8125rem !important;
        }

        /* Form inputs mobile */
        input,
        select,
        textarea {
            font-size: 16px !important;
            padding: 0.75rem !important;
        }

        label {
            font-size: 0.875rem !important;
        }

        /* Grid mobile */
        .grid.grid-cols-1.md\\:grid-cols-2,
        .grid.grid-cols-1.md\\:grid-cols-3 {
            grid-template-columns: 1fr !important;
        }

        .gap-3 {
            gap: 0.75rem !important;
        }

        /* Days checkboxes mobile */
        #days {
            gap: 0.5rem !important;
        }

        #days label {
            padding: 0.625rem 0.75rem !important;
            font-size: 0.8125rem !important;
            min-height: 44px;
            display: inline-flex;
            align-items: center;
        }

        /* Time inputs mobile */
        #startTime,
        #endTime {
            padding: 0.75rem !important;
            font-size: 16px !important;
        }

        /* Gallery dropzone mobile */
        #dropGallery {
            padding: 1.5rem 1rem !important;
            font-size: 0.875rem !important;
        }

        .flex.flex-wrap.gap-3 {
            gap: 0.5rem !important;
        }

        /* Gallery thumbs mobile */
        #gallery img {
            width: 5rem !important;
            height: 5rem !important;
        }

        #gallery button {
            width: 1.5rem !important;
            height: 1.5rem !important;
            font-size: 1rem !important;
        }

        /* Services grid mobile */
        .grid.grid-cols-3 {
            grid-template-columns: 1fr !important;
            gap: 0.5rem !important;
        }

        #services input {
            margin-bottom: 0.5rem !important;
        }

        #addService {
            padding: 0.625rem 0.875rem !important;
            font-size: 0.875rem !important;
            width: 100%;
            min-height: 44px;
        }

        /* Save button mobile */
        #save {
            width: 100%;
            padding: 0.875rem 1rem !important;
            font-size: 1rem !important;
            min-height: 48px;
        }

        /* Social inputs mobile */
        .flex.items-center.gap-2 {
            flex-direction: row;
            padding: 0.75rem !important;
        }

        .flex.items-center.gap-2 [data-lucide] {
            width: 1rem !important;
            height: 1rem !important;
            flex-shrink: 0;
        }

        .flex.items-center.gap-2 input {
            font-size: 0.875rem !important;
            padding: 0 !important;
        }

        /* Borders mobile */
        .border.rounded-xl {
            padding: 1rem !important;
        }

        /* Error messages mobile */
        .text-xs.text-red-600 {
            font-size: 0.75rem !important;
        }

        /* Spacing */
        .space-y-4>*+* {
            margin-top: 1rem !important;
        }

        .mb-4 {
            margin-bottom: 1rem !important;
        }

        .mb-2 {
            margin-bottom: 0.5rem !important;
        }

        .mb-6 {
            margin-bottom: 1.5rem !important;
        }

        .mt-3 {
            margin-top: 0.75rem !important;
        }

        .mt-1 {
            margin-top: 0.25rem !important;
        }
    }

    /* Small mobile (iPhone SE) */
    @media (max-width: 375px) {
        h1.text-2xl {
            font-size: 1.125rem !important;
        }

        #gallery img {
            width: 4rem !important;
            height: 4rem !important;
        }

        .rounded-2xl.border {
            padding: 0.75rem !important;
        }

        #days label {
            padding: 0.5rem 0.625rem !important;
            font-size: 0.75rem !important;
        }
    }

    /* Touch device optimizations */
    @media (hover: none) and (pointer: coarse) {

        input,
        select,
        textarea,
        button,
        label {
            -webkit-tap-highlight-color: rgba(242, 139, 178, 0.2);
        }

        * {
            -webkit-overflow-scrolling: touch;
        }

        button:active {
            opacity: 0.85;
            transform: scale(0.98);
        }

        #days label:active {
            opacity: 0.8;
        }
    }

    /* iOS Safari fixes */
    @supports (-webkit-touch-callout: none) {

        input,
        select,
        textarea {
            font-size: max(16px, 1rem) !important;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-6">
    <div class="flex items-center justify-between mb-4">
        <h1 class="text-2xl font-bold">Compléter mon profil</h1>
        <div class="text-xs text-gray-500">Vos informations seront visibles par les clients</div>
    </div>
    <div class="mb-6 rounded-2xl border bg-white/70 p-4 flex items-center gap-3">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-pink-100 to-blue-100 flex items-center justify-center"
            id="iconWrap">
            <i data-lucide="sparkles" class="w-6 h-6 text-pink-500"></i>
        </div>
        <img id="headAvatar" src="" alt="Profil" class="w-12 h-12 rounded-full object-cover hidden" />
        <div class="text-sm text-gray-600">Ajoutez une bio, vos réseaux, des photos et vos services pour attirer plus de
            clients.</div>
    </div>

    <div id="app" class="space-y-4" data-prefill='{{ prefill|default:"{}"|safe }}'>
        <div>
            <label class="block text-sm text-gray-600 mb-1">Ville</label>
            <input id="city" class="w-full border rounded-xl px-3 py-2" placeholder="Votre ville" />
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
                <label class="block text-sm text-gray-600 mb-1">Nom du centre</label>
                <input id="business" class="w-full border rounded-xl px-3 py-2"
                    placeholder="Nom de votre salon/centre" />
            </div>
            <div>
                <label class="block text-sm text-gray-600 mb-1">Téléphone</label>
                <input id="phone" class="w-full border rounded-xl px-3 py-2" placeholder="Téléphone" />
            </div>
        </div>
        <div>
            <label class="block text-sm text-gray-600 mb-1">Email</label>
            <input id="email" class="w-full border rounded-xl px-3 py-2 bg-gray-50" placeholder="—" disabled />
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
                <label class="block text-sm text-gray-600 mb-1">Catégorie d'activité</label>
                <select id="activity_category" class="w-full border rounded-xl px-3 py-2 bg-white">
                    <option value="">—</option>
                    <option value="hairdressing">Coiffure</option>
                    <option value="makeup">Maquillage</option>
                    <option value="manicure">Manucure</option>
                    <option value="esthetics">Esthétique</option>
                    <option value="massage">Massage</option>
                    <option value="other">Autre</option>
                </select>
                <div class="text-xs text-gray-500 mt-1">Préfilié depuis l'inscription, modifiable ici.</div>
            </div>
            <div>
                <label class="block text-sm text-gray-600 mb-1">Type de service</label>
                <select id="service_type" class="w-full border rounded-xl px-3 py-2 bg-white">
                    <option value="">—</option>
                    <option value="mobile">Je me déplace</option>
                    <option value="home">Je reçois chez moi</option>
                    <option value="salon">J'ai un salon</option>
                </select>
            </div>
        </div>
        <div>
            <label class="block text-sm text-gray-600 mb-1">Bio</label>
            <textarea id="bio" class="w-full border rounded-xl px-3 py-2" rows="4"
                placeholder="Parlez de vous"></textarea>
            <div id="err_bio" class="text-xs text-red-600 mt-1 hidden"></div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <div class="flex items-center gap-2 border rounded-xl px-3 py-2 bg-white/70">
                <i data-lucide="instagram" class="w-4 h-4 text-pink-500"></i>
                <input id="ig" class="w-full outline-none" placeholder="Lien Instagram (https://...)" />
            </div>
            <div class="flex items-center gap-2 border rounded-xl px-3 py-2 bg-white/70">
                <i data-lucide="facebook" class="w-4 h-4 text-blue-600"></i>
                <input id="fb" class="w-full outline-none" placeholder="Lien Facebook (https://...)" />
            </div>
            <div class="flex items-center gap-2 border rounded-xl px-3 py-2 bg-white/70">
                <i data-lucide="music-2" class="w-4 h-4 text-gray-700"></i>
                <input id="tt" class="w-full outline-none" placeholder="Lien TikTok (https://...)" />
            </div>
        </div>

        <div class="border rounded-xl p-3">
            <div class="font-medium mb-2">Jours de travail</div>
            <div id="days" class="flex flex-wrap gap-2">
                <label class="inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white/70"><input
                        type="checkbox" value="mon" class="accent-pink-500" /> Lun</label>
                <label class="inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white/70"><input
                        type="checkbox" value="tue" class="accent-pink-500" /> Mar</label>
                <label class="inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white/70"><input
                        type="checkbox" value="wed" class="accent-pink-500" /> Mer</label>
                <label class="inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white/70"><input
                        type="checkbox" value="thu" class="accent-pink-500" /> Jeu</label>
                <label class="inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white/70"><input
                        type="checkbox" value="fri" class="accent-pink-500" /> Ven</label>
                <label class="inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white/70"><input
                        type="checkbox" value="sat" class="accent-pink-500" /> Sam</label>
                <label class="inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white/70"><input
                        type="checkbox" value="sun" class="accent-pink-500" /> Dim</label>
            </div>
            <div class="mt-3 grid grid-cols-2 gap-2">
                <input id="startTime" type="time" class="border rounded-xl px-3 py-2" />
                <input id="endTime" type="time" class="border rounded-xl px-3 py-2" />
            </div>
            <div id="err_days" class="text-xs text-red-600 mt-1 hidden"></div>
        </div>

        <div class="border rounded-xl p-3">
            <div class="font-medium mb-2">Galerie (photos de réalisations)</div>
            <div id="gallery" class="flex flex-wrap gap-3 mb-3"></div>
            <div id="dropGallery"
                class="w-full rounded-xl border-2 border-dashed p-4 text-center text-sm text-gray-600 bg-white/60 cursor-pointer">
                Glissez-déposez des images ici ou <span class="text-blue-600">cliquez pour choisir</span>
                <input id="galleryInput" type="file" accept="image/*" class="hidden" multiple />
            </div>
        </div>

        <div class="border rounded-xl p-3">
            <div class="font-medium mb-2">Services & tarifs</div>
            <div id="services" class="space-y-2"></div>
            <button id="addService" class="mt-2 px-3 py-1 rounded-lg border">Ajouter un service</button>
            <div id="err_services" class="text-xs text-red-600 mt-1 hidden"></div>
        </div>

        <div>
            <button id="save" class="px-4 py-2 rounded-xl bg-pink-500 text-white">Enregistrer</button>
            <div id="hint" class="text-xs text-gray-500 mt-1"></div>
        </div>
    </div>
</div>

<script>
    function serviceRow(name = '', duration = '', price = '') {
        const wrap = document.createElement('div');
        wrap.className = 'grid grid-cols-3 gap-2';
        wrap.innerHTML = `<input class="border rounded-xl px-3 py-2" placeholder="Service" value="${name}">
                      <input class="border rounded-xl px-3 py-2" placeholder="Durée (min)" value="${duration}">
                      <input class="border rounded-xl px-3 py-2" placeholder="Prix (DT)" value="${price}">`;
        return wrap;
    }
    document.getElementById('addService').addEventListener('click', () => {
        document.getElementById('services').appendChild(serviceRow());
    });
    document.getElementById('services').appendChild(serviceRow());

    function getCookie(name) { const m = document.cookie.match('(^|;)\\s*' + name + '=\\s*([^;]+)'); return m ? m.pop() : ''; }
    // Prefill from server hints & render existing gallery
    (function () {
        try {
            const root = document.getElementById('app');
            const data = JSON.parse(root.getAttribute('data-prefill') || '{}');
            const extra = data.extra || {};
            if (extra.city) document.getElementById('city').value = extra.city;
            if (extra.bio) document.getElementById('bio').value = extra.bio;
            if (extra.business_name) document.getElementById('business').value = extra.business_name;
            if (extra.phone_number) document.getElementById('phone').value = extra.phone_number;
            if (extra.social_instagram) document.getElementById('ig').value = extra.social_instagram;
            if (extra.social_facebook) document.getElementById('fb').value = extra.social_facebook;
            if (extra.social_tiktok) document.getElementById('tt').value = extra.social_tiktok;
            // Prefill working days and hours
            (extra.working_days || []).forEach(code => {
                const el = document.querySelector('#days input[value="' + code + '"]');
                if (el) el.checked = true;
            });
            const wh = extra.working_hours || {};
            if (wh.start) document.getElementById('startTime').value = wh.start;
            if (wh.end) document.getElementById('endTime').value = wh.end;
            const services = extra.services || []; if (services.length) { const cont = document.getElementById('services'); cont.innerHTML = ''; services.forEach(s => cont.appendChild(serviceRow(s.name || '', s.duration_min || '', s.price || ''))); }
            const gallery = extra.gallery || []; if (gallery.length) { gallery.forEach(url => addThumb(url)); galleryData = gallery.slice(0); }
            const app = (data.application_hint || {});
            if (!document.getElementById('city').value && app.address) document.getElementById('city').value = app.address;
            if (app.salon_name) document.getElementById('business').value = app.salon_name;
            if (app.phone_number) document.getElementById('phone').value = app.phone_number;
            if (app.email) document.getElementById('email').value = app.email;
            if (app.profile_photo) {
                const img = document.getElementById('headAvatar');
                img.src = app.profile_photo; img.classList.remove('hidden');
                document.getElementById('iconWrap').classList.add('hidden');
            }
            if (app.activity_category) document.getElementById('activity_category').value = app.activity_category;
            if (app.service_type) document.getElementById('service_type').value = app.service_type;
        } catch (e) { }
    })();

    // Gallery management
    let galleryData = [];
    const gInput = document.getElementById('galleryInput');
    const drop = document.getElementById('dropGallery');
    drop.addEventListener('click', () => gInput.click());
    drop.addEventListener('dragover', (e) => { e.preventDefault(); drop.classList.add('bg-blue-50'); });
    drop.addEventListener('dragleave', () => drop.classList.remove('bg-blue-50'));
    drop.addEventListener('drop', (e) => { e.preventDefault(); drop.classList.remove('bg-blue-50'); if (e.dataTransfer.files?.length) { handleFiles(e.dataTransfer.files); } });
    gInput.addEventListener('change', (e) => { if (e.target.files?.length) { handleFiles(e.target.files); } });
    function handleFiles(fileList) {
        [...fileList].slice(0, 20).forEach(f => toBase64(f).then(b64 => { galleryData.push(b64); addThumb(b64); }));
    }
    function addThumb(src) {
        const box = document.createElement('div'); box.className = 'relative';
        box.innerHTML = `<img src="${src}" class="w-24 h-24 object-cover rounded-lg border"/>
                         <button type="button" class="absolute -right-2 -top-2 bg-black/70 text-white rounded-full w-6 h-6">×</button>`;
        box.querySelector('button').addEventListener('click', () => { box.remove(); galleryData = galleryData.filter(x => x !== src); });
        document.getElementById('gallery').appendChild(box);
    }
    function toBase64(file) { return new Promise((res, rej) => { const r = new FileReader(); r.onload = () => res(r.result); r.onerror = rej; r.readAsDataURL(file); }); }

    function validateFormInline() {
        const bio = document.getElementById('bio').value.trim();
        const days = getSelectedDays();
        const hasService = [...document.querySelectorAll('#services .grid')].some(row => {
            const [n, p] = [row.querySelectorAll('input')[0]?.value.trim(), row.querySelectorAll('input')[2]?.value.trim()];
            return n && p;
        });
        const setErr = (id, msg) => { const el = document.getElementById(id); if (!el) return; if (msg) { el.textContent = msg; el.classList.remove('hidden'); } else { el.textContent = ''; el.classList.add('hidden'); } };
        setErr('err_bio', bio ? '' : 'Veuillez renseigner votre bio.');
        setErr('err_days', days.length ? '' : 'Sélectionnez au moins un jour de travail.');
        setErr('err_services', hasService ? '' : 'Ajoutez au moins un service avec nom et prix.');
        if (!bio) document.getElementById('bio').classList.add('ring-1', 'ring-red-300'); else document.getElementById('bio').classList.remove('ring-1', 'ring-red-300');
        if (!days.length) document.getElementById('days').classList.add('ring-1', 'ring-red-300'); else document.getElementById('days').classList.remove('ring-1', 'ring-red-300');
        if (!hasService) document.getElementById('services').classList.add('ring-1', 'ring-red-300'); else document.getElementById('services').classList.remove('ring-1', 'ring-red-300');
        return bio && days.length && hasService;
    }

    // replace previous validateForm watchers
    document.getElementById('bio').addEventListener('input', validateFormInline);
    document.getElementById('days').addEventListener('click', validateFormInline);
    document.getElementById('services').addEventListener('input', validateFormInline);

    // initial inline state
    validateFormInline();

    document.getElementById('save').addEventListener('click', async () => {
        const ok = validateFormInline();
        if (!ok) {
            const first = document.querySelector('#err_bio:not(.hidden), #err_days:not(.hidden), #err_services:not(.hidden)');
            if (first) first.scrollIntoView({ behavior: 'smooth', block: 'center' });
            return;
        }
        const city = document.getElementById('city').value.trim();
        const bio = document.getElementById('bio').value.trim();
        const business = document.getElementById('business').value.trim();
        const phone = document.getElementById('phone').value.trim();
        const social_instagram = document.getElementById('ig').value.trim();
        const social_facebook = document.getElementById('fb').value.trim();
        const social_tiktok = document.getElementById('tt').value.trim();
        const days = getSelectedDays();
        const start = document.getElementById('startTime').value || '09:00';
        const end = document.getElementById('endTime').value || '18:00';
        const services = [...document.querySelectorAll('#services .grid')].map(row => {
            const [n, d, p] = row.querySelectorAll('input');
            if (!n.value.trim()) return null;
            return { name: n.value.trim(), duration_min: parseInt(d.value || '0'), price: parseFloat(p.value || '0') };
        }).filter(Boolean);
        // Simplified Validation: only Bio, Days, Services
        const errors = [];
        let firstInvalid = null; const setFirst = (el) => { if (!firstInvalid && el) firstInvalid = el; };
        const markInvalid = (id, bad) => { const el = typeof id === 'string' ? document.getElementById(id) : id; if (!el) return; el.classList.toggle('ring-1', bad); el.classList.toggle('ring-red-300', bad); el.classList.toggle('border-red-500', bad); };
        if (!bio) { errors.push('Bio requise'); markInvalid('bio', true); setFirst(document.getElementById('bio')); } else { markInvalid('bio', false); }
        if (!days.length) { errors.push('Sélectionnez au moins un jour'); markInvalid('days', true); setFirst(document.getElementById('days')); } else { markInvalid('days', false); }
        const hasService = [...document.querySelectorAll('#services .grid')].some(row => {
            const [n, p] = [row.querySelectorAll('input')[0]?.value.trim(), row.querySelectorAll('input')[2]?.value.trim()];
            return n && p;
        });
        if (!hasService) { errors.push('Ajoutez au moins un service (nom et prix)'); markInvalid('services', true); setFirst(document.getElementById('services')); } else { markInvalid('services', false); }
        if (errors.length) { alert(errors.join('\n')); if (firstInvalid) firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' }); return; }
        const payload = { bio, city, phone, business, social_instagram, social_facebook, social_tiktok, services, working_days: days, working_hours: { start, end }, gallery: galleryData };
        const res = await fetch('/pro/onboarding/save/', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': getCookie('csrftoken') }, body: JSON.stringify(payload) });
        if (res.ok) { window.location.href = '/pro/'; }
        else { alert('Échec de l\'enregistrement'); }
    });

    // Modern pills + predefined time selects
    const dayMap = [
        { code: 'mon', label: 'Lun' }, { code: 'tue', label: 'Mar' }, { code: 'wed', label: 'Mer' },
        { code: 'thu', label: 'Jeu' }, { code: 'fri', label: 'Ven' }, { code: 'sat', label: 'Sam' }, { code: 'sun', label: 'Dim' }
    ];
    function buildDayPills() {
        const container = document.getElementById('days'); if (!container) return; container.innerHTML = '';
        const current = new Set([...document.querySelectorAll('#days input:checked')].map(x => x.value));
        // Grouped modern pills
        const group = document.createElement('div'); group.className = 'flex flex-wrap gap-2';
        dayMap.forEach(d => {
            const pill = document.createElement('label'); pill.className = 'inline-flex items-center gap-2 px-3 py-1 rounded-full border bg-white/70';
            pill.innerHTML = `<input type="checkbox" value="${d.code}" class="accent-pink-500" /> ${d.label}`;
            pill.addEventListener('click', () => {
                pill.querySelector('input').checked = !pill.querySelector('input').checked;
                pill.classList.toggle('bg-pink-500'); pill.classList.toggle('text-white'); pill.classList.toggle('border-pink-500');
            });
            group.appendChild(pill);
        });
        container.appendChild(group);
    }
    function getSelectedDays() {
        const sel = []; document.querySelectorAll('#days input:checked').forEach(b => { sel.push(b.value); }); return sel;
    }
    function buildTimeSelects() {
        const s = document.getElementById('startTime'); const e = document.getElementById('endTime'); if (!s || !e) return;
        const options = []; for (let h = 6; h <= 22; h++) { for (let m of [0, 30]) { const hh = String(h).padStart(2, '0'); const mm = m === 0 ? '00' : '30'; options.push(`${hh}:${mm}`); } }
        s.innerHTML = ''; e.innerHTML = ''; options.forEach(v => { const o = document.createElement('option'); o.value = v; o.textContent = v; s.appendChild(o.cloneNode(true)); e.appendChild(o); });
    }

    // Presets
    document.getElementById('presetWeek').addEventListener('click', () => {
        setDays(['mon', 'tue', 'wed', 'thu', 'fri']);
        document.getElementById('startSel').value = '09:00';
        document.getElementById('endSel').value = '18:00';
        validateForm();
    });
    document.getElementById('presetDaily').addEventListener('click', () => {
        setDays(['mon', 'tue', 'wed', 'thu', 'fri', 'sat', 'sun']);
        document.getElementById('startSel').value = '10:00';
        document.getElementById('endSel').value = '20:00';
        validateForm();
    });
    document.getElementById('presetClear').addEventListener('click', () => {
        setDays([]);
        document.getElementById('startSel').value = '09:00';
        document.getElementById('endSel').value = '18:00';
        validateForm();
    });
    function setDays(list) {
        document.querySelectorAll('#days input:checked').forEach(b => {
            b.checked = false;
        });
        list.forEach(code => {
            const el = document.querySelector(`#days input[value="${code}"]`);
            if (el) el.checked = true;
        });
    }

    // Enable/disable save button based on form completeness
    const inputsToWatch = ['bio'];
    inputsToWatch.forEach(id => document.getElementById(id)?.addEventListener('input', validateForm));
    document.getElementById('days').addEventListener('click', validateForm);
    document.getElementById('services').addEventListener('input', validateForm);
    function validateForm() {
        const bio = document.getElementById('bio').value.trim();
        const days = getSelectedDays();
        const hasService = [...document.querySelectorAll('#services .grid')].some(row => {
            const [n, p] = [row.querySelectorAll('input')[0]?.value.trim(), row.querySelectorAll('input')[2]?.value.trim()];
            return n && p;
        });
        const ok = bio && days.length && hasService;
        const btn = document.getElementById('save'); const hint = document.getElementById('hint');
        btn.disabled = !ok; btn.classList.toggle('opacity-60', !ok); btn.classList.toggle('cursor-not-allowed', !ok);
        if (hint) hint.textContent = ok ? '' : 'Remplissez la bio, sélectionnez des jours et ajoutez au moins un service.';
    }
    // initial
    validateForm();
</script>
{% endblock %}