{% extends 'front_web/base_client.html' %}
{% load static %}

{% block title %}Mon Calendrier - Coucou Beauté{% endblock %}

{% block extra_css %}
<style>
    .calendar-container {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 24px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .calendar-header {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
        margin-bottom: 16px;
    }

    .calendar-day-header {
        text-align: center;
        font-weight: 600;
        color: #6B7280;
        padding: 12px 8px;
        font-size: 14px;
    }

    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 8px;
    }

    .calendar-day {
        aspect-ratio: 1;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        min-height: 48px;
    }

    .calendar-day:hover {
        background-color: #F3F4F6;
    }

    .calendar-day.today {
        background: linear-gradient(135deg, #F28BB2, #6CA9E0);
        color: white;
        font-weight: 600;
    }

    .calendar-day.has-appointment {
        background-color: #FEF3C7;
        border: 2px solid #F59E0B;
    }

    .calendar-day.has-appointment.today {
        background: linear-gradient(135deg, #F28BB2, #6CA9E0);
        border: 2px solid #F59E0B;
    }

    .appointment-dot {
        position: absolute;
        bottom: 4px;
        left: 50%;
        transform: translateX(-50%);
        width: 6px;
        height: 6px;
        background-color: #F59E0B;
        border-radius: 50%;
    }

    .appointment-dot.today {
        background-color: white;
    }

    .appointment-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        padding: 16px;
        margin-bottom: 12px;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
</style>
{% endblock %}

{% block content %}
<div class="p-6">
    <!-- En-tête de la page -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Mon Calendrier</h1>
        <p class="text-gray-600">Visualisez vos rendez-vous de beauté</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Calendrier principal -->
        <div class="lg:col-span-2">
            <div class="calendar-container">
                <!-- Navigation du calendrier -->
                <div class="flex items-center justify-between mb-6">
                    <button id="prevMonth" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <i data-lucide="chevron-left" class="w-5 h-5"></i>
                    </button>
                    <h2 id="currentMonth" class="text-xl font-semibold text-gray-900">Janvier 2024</h2>
                    <button id="nextMonth" class="p-2 hover:bg-gray-100 rounded-lg transition-colors">
                        <i data-lucide="chevron-right" class="w-5 h-5"></i>
                    </button>
                </div>

                <!-- En-têtes des jours -->
                <div class="calendar-header">
                    <div class="calendar-day-header">Lun</div>
                    <div class="calendar-day-header">Mar</div>
                    <div class="calendar-day-header">Mer</div>
                    <div class="calendar-day-header">Jeu</div>
                    <div class="calendar-day-header">Ven</div>
                    <div class="calendar-day-header">Sam</div>
                    <div class="calendar-day-header">Dim</div>
                </div>

                <!-- Grille du calendrier -->
                <div id="calendarGrid" class="calendar-grid">
                    <!-- Les jours seront générés par JavaScript -->
                </div>
            </div>
        </div>

        <!-- Panneau latéral -->
        <div class="space-y-6">
            <!-- Rendez-vous du jour sélectionné -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Rendez-vous du jour</h3>
                <div id="dayAppointments">
                    <div class="text-center py-8 text-gray-500">
                        <i data-lucide="calendar" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                        <p>Sélectionnez un jour pour voir les rendez-vous</p>
                    </div>
                </div>
            </div>

            <!-- Statistiques rapides -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Ce mois</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Rendez-vous total</span>
                        <span class="font-semibold text-gray-900">5</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Dépenses</span>
                        <span class="font-semibold text-rosePastel">450 DT</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-gray-600">Professionnels</span>
                        <span class="font-semibold text-gray-900">3</span>
                    </div>
                </div>
            </div>

            <!-- Actions rapides -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-100 p-6">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Actions rapides</h3>
                <div class="space-y-3">
                    <button
                        class="w-full px-4 py-3 bg-rosePastel text-white rounded-lg hover:bg-opacity-80 transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="plus" class="w-4 h-4"></i>
                        Nouveau rendez-vous
                    </button>
                    <button
                        class="w-full px-4 py-3 bg-blueLight text-white rounded-lg hover:bg-opacity-80 transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="search" class="w-4 h-4"></i>
                        Rechercher un pro
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Données des rendez-vous (à remplacer par des données réelles)
    const appointments = {
        '2024-01-15': [
            {
                id: 1,
                time: '14:30',
                duration: '1h30',
                professional: 'Sarah Martinez',
                service: 'Coiffure et maquillage',
                price: '120 DT',
                status: 'confirmed'
            }
        ],
        '2024-01-18': [
            {
                id: 2,
                time: '10:00',
                duration: '1h30',
                professional: 'Marie Dubois',
                service: 'Manucure et soins',
                price: '80 DT',
                status: 'confirmed'
            }
        ],
        '2024-01-22': [
            {
                id: 3,
                time: '16:00',
                duration: '2h',
                professional: 'Sophie Laurent',
                service: 'Soins du visage',
                price: '150 DT',
                status: 'pending'
            }
        ]
    };

    let currentDate = new Date();
    let selectedDate = null;

    // Initialiser le calendrier
    function initCalendar() {
        updateCalendar();
        setupEventListeners();
    }

    // Mettre à jour l'affichage du calendrier
    function updateCalendar() {
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        // Mettre à jour le titre
        const monthNames = [
            'Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin',
            'Juillet', 'Août', 'Septembre', 'Octobre', 'Novembre', 'Décembre'
        ];
        document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year}`;

        // Générer la grille du calendrier
        const firstDay = new Date(year, month, 1);
        const lastDay = new Date(year, month + 1, 0);
        const startDate = new Date(firstDay);
        startDate.setDate(startDate.getDate() - firstDay.getDay() + 1); // Commencer par lundi

        const calendarGrid = document.getElementById('calendarGrid');
        calendarGrid.innerHTML = '';

        // Générer 42 jours (6 semaines)
        for (let i = 0; i < 42; i++) {
            const date = new Date(startDate);
            date.setDate(startDate.getDate() + i);

            const dayElement = document.createElement('div');
            dayElement.className = 'calendar-day';
            dayElement.textContent = date.getDate();

            // Marquer le jour actuel
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayElement.classList.add('today');
            }

            // Marquer les jours avec des rendez-vous
            const dateString = date.toISOString().split('T')[0];
            if (appointments[dateString]) {
                dayElement.classList.add('has-appointment');
                const dot = document.createElement('div');
                dot.className = 'appointment-dot';
                if (dayElement.classList.contains('today')) {
                    dot.classList.add('today');
                }
                dayElement.appendChild(dot);
            }

            // Gérer la sélection
            dayElement.addEventListener('click', () => {
                selectedDate = dateString;
                updateDayAppointments(dateString);
                updateDaySelection();
            });

            calendarGrid.appendChild(dayElement);
        }
    }

    // Mettre à jour la sélection des jours
    function updateDaySelection() {
        document.querySelectorAll('.calendar-day').forEach(day => {
            day.classList.remove('selected');
        });

        if (selectedDate) {
            const dayElements = document.querySelectorAll('.calendar-day');
            dayElements.forEach(day => {
                const dayDate = new Date(selectedDate);
                if (day.textContent == dayDate.getDate() &&
                    dayDate.getMonth() === currentDate.getMonth()) {
                    day.classList.add('selected');
                }
            });
        }
    }

    // Mettre à jour les rendez-vous du jour sélectionné
    function updateDayAppointments(dateString) {
        const dayAppointments = document.getElementById('dayAppointments');
        const dayAppointmentsData = appointments[dateString] || [];

        if (dayAppointmentsData.length === 0) {
            dayAppointments.innerHTML = `
                <div class="text-center py-8 text-gray-500">
                    <i data-lucide="calendar" class="w-12 h-12 mx-auto mb-2 text-gray-300"></i>
                    <p>Aucun rendez-vous ce jour</p>
                </div>
            `;
        } else {
            dayAppointments.innerHTML = dayAppointmentsData.map(apt => `
                <div class="appointment-card">
                    <div class="flex items-center justify-between mb-2">
                        <span class="font-semibold text-gray-900">${apt.time}</span>
                        <span class="px-2 py-1 text-xs rounded-full ${apt.status === 'confirmed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                }">
                            ${apt.status === 'confirmed' ? 'Confirmé' : 'En attente'}
                        </span>
                    </div>
                    <h4 class="font-medium text-gray-900">${apt.professional}</h4>
                    <p class="text-sm text-gray-600">${apt.service}</p>
                    <p class="text-sm text-rosePastel font-medium">${apt.price}</p>
                </div>
            `).join('');
        }

        // Réinitialiser les icônes
        lucide.createIcons();
    }

    // Configurer les événements
    function setupEventListeners() {
        document.getElementById('prevMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        });

        document.getElementById('nextMonth').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        });
    }

    // Initialiser le calendrier au chargement de la page
    document.addEventListener('DOMContentLoaded', () => {
        initCalendar();
        lucide.createIcons();
    });
</script>
{% endblock %}